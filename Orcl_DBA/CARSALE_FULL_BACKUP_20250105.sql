--------------------------------------------------------
--  File created - Friday-December-05-2025   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Sequence SEQ_CAR
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_CAR"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 41 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_CUSTOMER
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_CUSTOMER"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 101 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_DATA_LABEL
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_DATA_LABEL"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 41 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_FEEDBACK
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_FEEDBACK"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_KEY
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_KEY"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 41 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_LOG
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_LOG"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 221 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_ORDER
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_ORDER"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 21 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_ROLE
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_ROLE"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_SECURITY_COMP
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_SECURITY_COMP"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_SECURITY_LEVEL
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_SECURITY_LEVEL"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_USER_LABEL
--------------------------------------------------------

   CREATE SEQUENCE  "CARSALE"."SEQ_USER_LABEL"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 41 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Table ACCOUNT_ROLE
--------------------------------------------------------

  CREATE TABLE "CARSALE"."ACCOUNT_ROLE" 
   (	"MATK" NUMBER, 
	"MAKH" NUMBER, 
	"ROLENAME" VARCHAR2(30 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
  GRANT ALTER ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT DELETE ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT UPDATE ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT READ ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT ON COMMIT REFRESH ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT QUERY REWRITE ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT DEBUG ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
  GRANT FLASHBACK ON "CARSALE"."ACCOUNT_ROLE" TO "CARSALE_ADMIN_ROLE";
--------------------------------------------------------
--  DDL for Table AUDIT_LOG
--------------------------------------------------------

  CREATE TABLE "CARSALE"."AUDIT_LOG" 
   (	"MALOG" NUMBER, 
	"MATK" NUMBER, 
	"HANHDONG" VARCHAR2(100 BYTE), 
	"BANGTACDONG" VARCHAR2(50 BYTE), 
	"NGAYGIO" DATE DEFAULT SYSDATE, 
	"IP" VARCHAR2(30 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
  GRANT ALTER ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT DELETE ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT UPDATE ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT READ ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT ON COMMIT REFRESH ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT QUERY REWRITE ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT DEBUG ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT FLASHBACK ON "CARSALE"."AUDIT_LOG" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."AUDIT_LOG" TO "CARSALE_MANAGER_ROLE";
--------------------------------------------------------
--  DDL for Table CAR
--------------------------------------------------------

  CREATE TABLE "CARSALE"."CAR" 
   (	"MAXE" NUMBER, 
	"TENXE" VARCHAR2(100 BYTE), 
	"HANGXE" VARCHAR2(50 BYTE), 
	"GIA" NUMBER(12,2), 
	"NAMSX" NUMBER(4,0), 
	"MOTA" VARCHAR2(4000 BYTE), 
	"HINHANH" VARCHAR2(200 BYTE), 
	"TRANGTHAI" VARCHAR2(30 BYTE) DEFAULT 'Con hang'
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
  GRANT ALTER ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT DELETE ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT UPDATE ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT READ ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT ON COMMIT REFRESH ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT QUERY REWRITE ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT DEBUG ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT FLASHBACK ON "CARSALE"."CAR" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."CAR" TO "CARSALE_MANAGER_ROLE";
  GRANT SELECT ON "CARSALE"."CAR" TO "CARSALE_MANAGER_ROLE";
  GRANT UPDATE ON "CARSALE"."CAR" TO "CARSALE_MANAGER_ROLE";
  GRANT SELECT ON "CARSALE"."CAR" TO "CARSALE_SALES_ROLE";
  GRANT SELECT ON "CARSALE"."CAR" TO "CARSALE_VIEWER_ROLE";
--------------------------------------------------------
--  DDL for Table CUSTOMER
--------------------------------------------------------

  CREATE TABLE "CARSALE"."CUSTOMER" 
   (	"MAKH" NUMBER, 
	"HOTEN" VARCHAR2(100 BYTE), 
	"EMAIL" VARCHAR2(100 BYTE), 
	"SDT" VARCHAR2(20 BYTE), 
	"MATKHAU" VARCHAR2(256 BYTE), 
	"DIACHI" VARCHAR2(200 BYTE), 
	"NGAYDANGKY" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
  GRANT ALTER ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT DELETE ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT UPDATE ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT READ ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT ON COMMIT REFRESH ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT QUERY REWRITE ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT DEBUG ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT FLASHBACK ON "CARSALE"."CUSTOMER" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."CUSTOMER" TO "CARSALE_MANAGER_ROLE";
  GRANT SELECT ON "CARSALE"."CUSTOMER" TO "CARSALE_MANAGER_ROLE";
  GRANT UPDATE ON "CARSALE"."CUSTOMER" TO "CARSALE_MANAGER_ROLE";
  GRANT SELECT ON "CARSALE"."CUSTOMER" TO "CARSALE_SALES_ROLE";
--------------------------------------------------------
--  DDL for Table DATA_SECURITY_LABEL
--------------------------------------------------------

  CREATE TABLE "CARSALE"."DATA_SECURITY_LABEL" 
   (	"DATA_LABEL_ID" NUMBER, 
	"TABLE_NAME" VARCHAR2(50 BYTE), 
	"RECORD_ID" NUMBER, 
	"SECURITY_LEVEL" NUMBER, 
	"COMPARTMENTS" VARCHAR2(200 BYTE), 
	"CREATED_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
--------------------------------------------------------
--  DDL for Table ENCRYPTION_KEY
--------------------------------------------------------

  CREATE TABLE "CARSALE"."ENCRYPTION_KEY" 
   (	"KEYID" NUMBER, 
	"KEYTYPE" VARCHAR2(20 BYTE), 
	"PUBLICKEY" VARCHAR2(4000 BYTE), 
	"PRIVATEKEY" VARCHAR2(4000 BYTE), 
	"CREATEDDATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
--------------------------------------------------------
--  DDL for Table FEEDBACK
--------------------------------------------------------

  CREATE TABLE "CARSALE"."FEEDBACK" 
   (	"MAFB" NUMBER, 
	"MAKH" NUMBER, 
	"MAXE" NUMBER, 
	"NOIDUNG" VARCHAR2(1000 BYTE), 
	"DIEMDANHGIA" NUMBER(1,0), 
	"NGAYDANHGIA" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "CARSALE_TBS" ;
  GRANT ALTER ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT DELETE ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT UPDATE ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT READ ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT ON COMMIT REFRESH ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT QUERY REWRITE ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT DEBUG ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT FLASHBACK ON "CARSALE"."FEEDBACK" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."FEEDBACK" TO "CARSALE_VIEWER_ROLE";
--------------------------------------------------------
--  DDL for Table ORDERS
--------------------------------------------------------

  CREATE TABLE "CARSALE"."ORDERS" 
   (	"MADON" NUMBER, 
	"MAKH" NUMBER, 
	"NGAYDAT" DATE DEFAULT SYSDATE, 
	"TONGTIEN" NUMBER(12,2), 
	"TRANGTHAI" VARCHAR2(30 BYTE) DEFAULT 'Cho xu ly'
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
  GRANT ALTER ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT DELETE ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT UPDATE ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT READ ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT ON COMMIT REFRESH ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT QUERY REWRITE ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT DEBUG ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT FLASHBACK ON "CARSALE"."ORDERS" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."ORDERS" TO "CARSALE_MANAGER_ROLE";
  GRANT SELECT ON "CARSALE"."ORDERS" TO "CARSALE_MANAGER_ROLE";
  GRANT UPDATE ON "CARSALE"."ORDERS" TO "CARSALE_MANAGER_ROLE";
  GRANT INSERT ON "CARSALE"."ORDERS" TO "CARSALE_SALES_ROLE";
  GRANT SELECT ON "CARSALE"."ORDERS" TO "CARSALE_SALES_ROLE";
  GRANT UPDATE ON "CARSALE"."ORDERS" TO "CARSALE_SALES_ROLE";
--------------------------------------------------------
--  DDL for Table ORDER_DETAIL
--------------------------------------------------------

  CREATE TABLE "CARSALE"."ORDER_DETAIL" 
   (	"MADON" NUMBER, 
	"MAXE" NUMBER, 
	"SOLUONG" NUMBER, 
	"DONGIA" NUMBER(12,2)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
  GRANT ALTER ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT DELETE ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT SELECT ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT UPDATE ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT READ ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT ON COMMIT REFRESH ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT QUERY REWRITE ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT DEBUG ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT FLASHBACK ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
  GRANT INSERT ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_SALES_ROLE";
  GRANT SELECT ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_SALES_ROLE";
  GRANT UPDATE ON "CARSALE"."ORDER_DETAIL" TO "CARSALE_SALES_ROLE";
--------------------------------------------------------
--  DDL for Table SECURITY_COMPARTMENT
--------------------------------------------------------

  CREATE TABLE "CARSALE"."SECURITY_COMPARTMENT" 
   (	"COMP_ID" NUMBER, 
	"COMP_NAME" VARCHAR2(50 BYTE), 
	"COMP_CODE" VARCHAR2(10 BYTE), 
	"DESCRIPTION" VARCHAR2(200 BYTE), 
	"CREATED_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
--------------------------------------------------------
--  DDL for Table SECURITY_LEVEL
--------------------------------------------------------

  CREATE TABLE "CARSALE"."SECURITY_LEVEL" 
   (	"LEVEL_ID" NUMBER, 
	"LEVEL_NAME" VARCHAR2(50 BYTE), 
	"LEVEL_NUM" NUMBER, 
	"DESCRIPTION" VARCHAR2(200 BYTE), 
	"CREATED_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
--------------------------------------------------------
--  DDL for Table USER_SECURITY_LABEL
--------------------------------------------------------

  CREATE TABLE "CARSALE"."USER_SECURITY_LABEL" 
   (	"USER_LABEL_ID" NUMBER, 
	"MAKH" NUMBER, 
	"MAX_READ_LEVEL" NUMBER, 
	"MAX_WRITE_LEVEL" NUMBER, 
	"COMPARTMENTS" VARCHAR2(200 BYTE), 
	"CREATED_DATE" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
--------------------------------------------------------
--  DDL for View VW_AUDIT_LOG_DETAIL
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "CARSALE"."VW_AUDIT_LOG_DETAIL" ("MALOG", "MATK", "HOTEN", "EMAIL", "ROLENAME", "HANHDONG", "BANGTACDONG", "NGAYGIO", "IP") AS 
  SELECT 
    al.MALOG,
    al.MATK,
    c.HOTEN,
    c.EMAIL,
    ar.ROLENAME,
    al.HANHDONG,
    al.BANGTACDONG,
    al.NGAYGIO,
    al.IP
FROM AUDIT_LOG al
LEFT JOIN CUSTOMER c ON al.MATK = c.MAKH
LEFT JOIN ACCOUNT_ROLE ar ON al.MATK = ar.MATK
ORDER BY al.NGAYGIO DESC
;
--------------------------------------------------------
--  DDL for View VW_SECURITY_ASSIGNMENTS
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "CARSALE"."VW_SECURITY_ASSIGNMENTS" ("MAKH", "HOTEN", "EMAIL", "MAX_READ_LEVEL", "MAX_WRITE_LEVEL", "USER_COMPARTMENTS", "READ_LEVEL_NAME", "DATA_SECURITY_LEVEL", "DATA_COMPARTMENTS") AS 
  SELECT 
    c.MAKH,
    c.HOTEN,
    c.EMAIL,
    usl.MAX_READ_LEVEL,
    usl.MAX_WRITE_LEVEL,
    usl.COMPARTMENTS AS USER_COMPARTMENTS,
    sl.LEVEL_NAME AS READ_LEVEL_NAME,
    dsl.SECURITY_LEVEL AS DATA_SECURITY_LEVEL,
    dsl.COMPARTMENTS AS DATA_COMPARTMENTS
FROM CUSTOMER c
LEFT JOIN USER_SECURITY_LABEL usl ON c.MAKH = usl.MAKH
LEFT JOIN SECURITY_LEVEL sl ON usl.MAX_READ_LEVEL = sl.LEVEL_NUM
LEFT JOIN DATA_SECURITY_LABEL dsl ON c.MAKH = dsl.RECORD_ID AND dsl.TABLE_NAME = 'CUSTOMER'
;
--------------------------------------------------------
--  DDL for View VW_SECURITY_EVENTS
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "CARSALE"."VW_SECURITY_EVENTS" ("EVENT_TIME", "USER_EMAIL", "ACTION", "TARGET_TABLE", "SOURCE_IP", "EVENT_TYPE") AS 
  SELECT 
    al.NGAYGIO AS EVENT_TIME,
    c.EMAIL AS USER_EMAIL,
    al.HANHDONG AS ACTION,
    al.BANGTACDONG AS TARGET_TABLE,
    al.IP AS SOURCE_IP,
    CASE 
        WHEN al.HANHDONG LIKE 'ACCESS_DENIED%' THEN 'SECURITY_VIOLATION'
        WHEN al.HANHDONG IN ('LOGIN', 'LOGOUT') THEN 'AUTHENTICATION'
        WHEN al.HANHDONG LIKE 'GRANT%' THEN 'AUTHORIZATION'
        ELSE 'DATA_OPERATION'
    END AS EVENT_TYPE
FROM AUDIT_LOG al
LEFT JOIN CUSTOMER c ON al.MATK = c.MAKH
WHERE al.NGAYGIO >= SYSDATE - 30
ORDER BY al.NGAYGIO DESC
;
--------------------------------------------------------
--  DDL for View VW_SECURITY_STATS
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "CARSALE"."VW_SECURITY_STATS" ("NGAY", "TOTAL_EVENTS", "LOGIN_COUNT", "LOGOUT_COUNT", "ACCESS_DENIED_COUNT", "DATA_CHANGES") AS 
  SELECT 
    TO_CHAR(NGAYGIO, 'YYYY-MM-DD') AS NGAY,
    COUNT(*) AS TOTAL_EVENTS,
    SUM(CASE WHEN HANHDONG = 'LOGIN' THEN 1 ELSE 0 END) AS LOGIN_COUNT,
    SUM(CASE WHEN HANHDONG = 'LOGOUT' THEN 1 ELSE 0 END) AS LOGOUT_COUNT,
    SUM(CASE WHEN HANHDONG LIKE 'ACCESS_DENIED%' THEN 1 ELSE 0 END) AS ACCESS_DENIED_COUNT,
    SUM(CASE WHEN HANHDONG IN ('INSERT', 'UPDATE', 'DELETE') THEN 1 ELSE 0 END) AS DATA_CHANGES
FROM AUDIT_LOG
WHERE NGAYGIO >= SYSDATE - 30
GROUP BY TO_CHAR(NGAYGIO, 'YYYY-MM-DD')
ORDER BY NGAY DESC
;
--------------------------------------------------------
--  DDL for View VW_USER_ROLES
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "CARSALE"."VW_USER_ROLES" ("MAKH", "HOTEN", "EMAIL", "SDT", "ROLENAME", "NGAYDANGKY", "TOTAL_ACTIVITIES") AS 
  SELECT 
    c.MAKH,
    c.HOTEN,
    c.EMAIL,
    c.SDT,
    ar.ROLENAME,
    c.NGAYDANGKY,
    (SELECT COUNT(*) FROM AUDIT_LOG WHERE MATK = c.MAKH) AS TOTAL_ACTIVITIES
FROM CUSTOMER c
LEFT JOIN ACCOUNT_ROLE ar ON c.MAKH = ar.MAKH
;
REM INSERTING into CARSALE.ACCOUNT_ROLE
SET DEFINE OFF;
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (1,1,'CUSTOMER');
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (2,2,'CUSTOMER');
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (3,3,'CUSTOMER');
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (21,21,'CUSTOMER');
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (22,22,'CUSTOMER');
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (23,23,'CUSTOMER');
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (81,81,'MANAGER');
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (41,41,'MANAGER');
Insert into CARSALE.ACCOUNT_ROLE (MATK,MAKH,ROLENAME) values (61,61,'ADMIN');
REM INSERTING into CARSALE.AUDIT_LOG
SET DEFINE OFF;
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (64,2,'LOGIN','CUSTOMER',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (93,41,'LOGIN','CUSTOMER',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (121,2,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (122,2,'LOGOUT','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (123,2,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (124,2,'LOGOUT','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (125,2,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (126,2,'LOGOUT','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (127,2,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (128,2,'LOGOUT','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (129,2,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (141,41,'LOGIN','CUSTOMER',to_date('02-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (1,1,'REGISTER','CUSTOMER',to_date('15-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (2,1,'LOGIN','CUSTOMER',to_date('15-NOV-25','DD-MON-RR'),'192.168.1.100');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (3,2,'REGISTER','CUSTOMER',to_date('15-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (61,0,'BACKUP','CUSTOMER -> CUSTOMER_TEST_BACKUP',to_date('21-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (62,0,'BACKUP','CUSTOMER -> CUSTOMER_TEST_BACKUP',to_date('21-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (63,0,'BACKUP','CUSTOMER -> CUSTOMER_TEST_BACKUP',to_date('21-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (65,0,'DELETE','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (66,0,'DELETE','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (67,0,'DELETE','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (68,0,'DELETE','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (69,0,'DELETE','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (70,0,'DELETE','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (71,0,'DELETE','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (72,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (73,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (74,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (75,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (76,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (77,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (78,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (79,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (80,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (81,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (82,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (83,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (84,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (85,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (86,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (87,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (88,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (89,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (90,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (91,0,'INSERT','CAR',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (101,2,'LOGIN','CUSTOMER',to_date('24-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (130,2,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (131,2,'UPDATE','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (132,2,'CHANGE_PASSWORD','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (182,61,'LOGIN','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (183,61,'LOGOUT','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (184,61,'LOGIN','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (185,61,'LOGIN','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (186,61,'CHANGE_ROLE: User #41 to MANAGER','ACCOUNT_ROLE',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (4,3,'REGISTER','CUSTOMER',to_date('15-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (5,1,'LOGIN','CUSTOMER',to_date('15-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (21,2,'LOGIN','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (22,2,'LOGIN','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (23,21,'REGISTER','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (24,2,'LOGIN','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (25,2,'LOGIN','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (26,2,'LOGOUT','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (27,22,'REGISTER','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (28,23,'REGISTER','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (29,22,'LOGIN','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (30,2,'LOGIN','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (31,2,'LOGIN','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (32,2,'LOGOUT','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (33,2,'LOGIN','CUSTOMER',to_date('16-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (161,41,'LOGIN','CUSTOMER',to_date('04-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (162,41,'LOGOUT','CUSTOMER',to_date('04-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (163,41,'LOGIN','CUSTOMER',to_date('04-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (164,41,'INSERT','ORDERS',to_date('04-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (165,0,'UPDATE','CAR',to_date('04-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (166,41,'CREATE_ORDER','ORDERS',to_date('04-DEC-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (167,41,'INSERT','ORDERS',to_date('04-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (168,0,'UPDATE','CAR',to_date('04-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (169,41,'CREATE_ORDER','ORDERS',to_date('04-DEC-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (170,41,'UPDATE','ORDERS',to_date('04-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (171,41,'INSERT','ORDERS',to_date('04-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (172,0,'UPDATE','CAR',to_date('04-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (173,41,'CREATE_ORDER','ORDERS',to_date('04-DEC-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (181,81,'INSERT','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (187,61,'LOGIN','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (188,0,'UPDATE','CAR',to_date('05-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (189,61,'DELETE_PRODUCT: #17','ADMIN_ACTION',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (190,0,'INSERT','CAR',to_date('05-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (191,61,'CREATE_PRODUCT: VinFast VF 3','ADMIN_ACTION',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (192,0,'UPDATE','CAR',to_date('05-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (194,0,'UPDATE','CAR',to_date('05-DEC-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (197,61,'UPDATE_ORDER_STATUS: Order #3 to Hoan thanh','ADMIN_ACTION',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (198,61,'LOGIN','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (199,61,'LOGOUT','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (200,61,'LOGIN','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (201,61,'LOGIN','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (202,61,'LOGOUT','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (203,41,'LOGIN','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (204,41,'LOGOUT','CUSTOMER',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (41,2,'LOGIN','CUSTOMER',to_date('17-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (42,2,'LOGOUT','CUSTOMER',to_date('17-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (43,41,'REGISTER','CUSTOMER',to_date('17-NOV-25','DD-MON-RR'),null);
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (44,41,'LOGIN','CUSTOMER',to_date('17-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (92,2,'LOGIN','CUSTOMER',to_date('21-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (133,2,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (134,2,'LOGOUT','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (135,41,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (136,41,'UPDATE','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'::1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (137,41,'CHANGE_PASSWORD','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (138,41,'LOGOUT','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (139,41,'LOGIN','CUSTOMER',to_date('25-NOV-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (174,61,'INSERT','CUSTOMER',to_date('04-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (193,61,'UPDATE_STATUS: Product #14 to Con hang','ADMIN_ACTION',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (195,61,'UPDATE_STATUS: Product #13 to Con hang','ADMIN_ACTION',to_date('05-DEC-25','DD-MON-RR'),'127.0.0.1');
Insert into CARSALE.AUDIT_LOG (MALOG,MATK,HANHDONG,BANGTACDONG,NGAYGIO,IP) values (196,41,'UPDATE','ORDERS',to_date('05-DEC-25','DD-MON-RR'),'::1');
REM INSERTING into CARSALE.CAR
SET DEFINE OFF;
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (1,'VinFast Fadil','VinFast',425000000,2021,'Xe hatchback 5 chỗ cỡ nhỏ, phù hợp di chuyển trong đô thị. Tiết kiệm nhiên liệu, vận hành linh hoạt. Trang bị tiêu chuẩn với màn hình cảm ứng, camera lùi, cảm biến lùi.','images/vinfast_fadil.jpg','Het hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (2,'VinFast Lux A2.0','VinFast',1100000000,2020,'Sedan hạng D cao cấp, thiết kế sang trọng, động cơ BMW 2.0L turbo công suất 228 mã lực. Nội thất da cao cấp, hệ thống giải trí 10.4 inch, hệ thống an toàn 6 túi khí.','images/vinfast_lux_a.jpg','Het hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (3,'VinFast Lux SA2.0','VinFast',1350000000,2021,'SUV 7 chỗ hạng sang, khung gầm BMW, động cơ 2.0L turbo 228 mã lực. Nội thất 3 hàng ghế rộng rãi, hệ thống an toàn đạt chuẩn ASEAN NCAP 5 sao, phanh ABS, hỗ trợ khởi hành ngang dốc.','images/vinfast_lux_sa.jpg','Het hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (4,'VinFast President','VinFast',4600000000,2021,'SUV hạng sang giới hạn, động cơ V8 6.2L công suất 420 mã lực. Nội thất siêu sang với da Nappa, gỗ thật, hệ thống âm thanh Klipsch 13 loa, ghế massage, tủ lạnh mini. Biểu tượng đẳng cấp Việt Nam.','images/vinfast_president.jpg','Het hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (5,'VinFast VF e34','VinFast',690000000,2022,'SUV điện đầu tiên của VinFast, pin 42 kWh, quãng đường 300km. Động cơ điện 110 kW, sạc nhanh DC 80% trong 30 phút. Màn hình trung tâm 10 inch, kết nối smartphone, camera 360 độ.','images/vinfast_vfe34.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (6,'VinFast VF 5 Plus','VinFast',468000000,2023,'SUV điện mini 5 chỗ, pin 37.23 kWh, quãng đường 326km. Thiết kế trẻ trung, năng động, phù hợp đô thị. Hệ thống an toàn ADAS Level 2, phanh ABS, EBD, ESC, 6 túi khí.','images/vinfast_vf5.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (7,'VinFast VF 6','VinFast',675000000,2024,'SUV điện compact 5 chỗ, pin 59.6 kWh, quãng đường 410km. Động cơ 130 kW, gia tốc 0-100km/h trong 8.9 giây. Màn hình trung tâm 12.9 inch, hệ thống ADAS thông minh, sạc nhanh 70% trong 30 phút.','images/vinfast_vf6.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (8,'VinFast VF 7 Base','VinFast',850000000,2024,'SUV điện 5 chỗ tầm trung, pin 59.6 kWh, quãng đường 375km. Động cơ 150 kW, vận hành mạnh mẽ. Nội thất rộng rãi, cốp xe 1373L, màn hình 12.9 inch, sạc không dây, 6 loa.','images/vinfast_vf7_base.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (9,'VinFast VF 7 Plus','VinFast',999000000,2024,'Bản cao cấp của VF 7, pin 75.3 kWh, quãng đường 450km. Nâng cấp hệ thống âm thanh 11 loa, ghế da cao cấp, cửa sổ trời toàn cảnh, hệ thống ADAS Level 2+ với tính năng tự lái bán tự động.','images/vinfast_vf7_plus.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (10,'VinFast VF 8 Eco','VinFast',1090000000,2023,'SUV điện 5 chỗ cao cấp, pin 82 kWh, quãng đường 447km. Động cơ 260 kW AWD, công suất 349 mã lực, gia tốc 0-100km/h trong 5.9 giây. Màn hình 15.6 inch, hệ thống loa 11 loa, ghế chỉnh điện 12 hướng.','images/vinfast_vf8_eco.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (11,'VinFast VF 8 Plus','VinFast',1250000000,2023,'Bản cao cấp nhất VF 8, pin 87.7 kWh, quãng đường 471km. Hệ thống ADAS Level 2+ thông minh nhất, trợ lý ảo tiếng Việt, cửa sổ trời panorama, ghế massage, hệ thống đèn LED matrix thông minh.','images/vinfast_vf8_plus.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (12,'VinFast VF 9 Eco','VinFast',1590000000,2023,'SUV điện 7 chỗ flagship, pin 92 kWh, quãng đường 438km. Động cơ 300 kW AWD, công suất 402 mã lực. 3 hàng ghế rộng rãi, màn hình 15.6 inch, hệ thống âm thanh cao cấp 13 loa, sạc nhanh 150kW.','images/vinfast_vf9_eco.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (13,'VinFast VF 9 Plus','VinFast',1890000000,2023,'Bản cao cấp nhất VF 9, pin 123 kWh, quãng đường 594km - dài nhất phân khúc. Nội thất siêu sang với da Nappa, gỗ thật, 7 chỗ ngồi VIP. Hệ thống ADAS Level 2+ đầy đủ, camera 360°, đèn LED matrix, phanh Brembo.','images/vinfast_vf9_plus.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (14,'VinFast VF 3','VinFast',235000000,2024,'Xe điện mini 2 cửa 4 chỗ ngồi, giá rẻ nhất phân khúc. Pin 18.64 kWh, quãng đường 215km, phù hợp di chuyển nội thành. Thiết kế nhỏ gọn dễ đỗ xe, tiết kiệm chi phí vận hành. Màn hình 10 inch, camera lùi.','images/vinfast_vf3.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (15,'VinFast VF Wild (Pre-order)','VinFast',2500000000,2025,'Bán tải điện đầu tiên của VinFast, thiết kế off-road mạnh mẽ. Pin 150 kWh, quãng đường 600km. Động cơ AWD 330 kW, khả năng kéo 3500kg. Hệ thống treo nâng hạ điện tử, camera 360°, màn hình 17.5 inch. Dự kiến ra mắt 2025.','images/vinfast_vf_wild.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (16,'VinFast VF 6 Sedan','VinFast',780000000,2024,'Sedan điện 5 chỗ phân khúc C, pin 59.6 kWh, quãng đường 400km. Thiết kế thể thao, khí động học tối ưu. Động cơ 130 kW, gia tốc nhanh. Hệ thống ADAS đầy đủ, màn hình 12.9 inch, sạc nhanh 70% trong 29 phút.','images/vinfast_vf6_sedan.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (17,'VinFast VF Cargo','VinFast',550000000,2024,'Xe tải nhẹ điện chuyên dụng cho vận chuyển hàng hóa. Pin 40 kWh, quãng đường 250km, tải trọng 800kg. Khoang chứa hàng rộng 4m³, cửa hông tiện lợi. Phù hợp logistics, giao hàng nội thành, tiết kiệm chi phí vận hành.','images/vinfast_vf_cargo.jpg','Da xoa');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (18,'VinFast VF Bus 16','VinFast',3500000000,2023,'Xe bus điện 16 chỗ ngồi, pin 165 kWh, quãng đường 300km. Động cơ 180 kW, vận hành êm ái không tiếng ồn. Nội thất rộng rãi, ghế ngồi thoải mái, điều hòa trung tâm. Phù hợp vận chuyển hành khách nội thành, du lịch.','images/vinfast_bus.jpg','Het hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (19,'VinFast Klara S','VinFast',21000000,2024,'Xe máy điện thông minh, pin Lithium 1.2 kWh, quãng đường 50km/sạc. Thiết kế hiện đại, màn hình LCD đa thông tin, khóa thông minh, sạc nhanh 3 giờ. Phù hợp học sinh, sinh viên di chuyển nội thành.','images/vinfast_klara_s.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (20,'VinFast Theon S','VinFast',53000000,2024,'Xe máy điện cao cấp, pin 3.5 kWh, quãng đường 140km. Động cơ 3.5 kW, tốc độ tối đa 90km/h. Màn hình TFT 7 inch, kết nối smartphone, chống trộm GPS. Thiết kế thể thao, phù hợp người trẻ năng động.','images/vinfast_theon_s.jpg','Con hang');
Insert into CARSALE.CAR (MAXE,TENXE,HANGXE,GIA,NAMSX,MOTA,HINHANH,TRANGTHAI) values (21,'VinFast VF 3','Vinfast',200000000,2025,null,null,'Con hang');
REM INSERTING into CARSALE.CUSTOMER
SET DEFINE OFF;
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (1,'Nguyen Van A','nguyenvana@gmail.com','0901234567','EF92B778BAFE771E89245B89ECBC08A44A4E166C06659911881F383D4473E94F','123 Nguyen Hue, TPHCM',to_date('15-NOV-25','DD-MON-RR'));
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (2,'Test User','test@test.com','0900000000','810BCE6C7B4AB35B984461DE23C54A4D100A62BE5567EC8A3600E95AC7CEB072','Test Address',to_date('15-NOV-25','DD-MON-RR'));
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (3,'TEKY|Trợ Giảng_Nguyễn Hoài Nam','namtqn2@gmail.com','+84971224228','A9222073D0D46D3C8EB307997FA3D634460F91117418198C0ADACAEF9B1304E2','4/7 Lưu Chí Hiếu',to_date('15-NOV-25','DD-MON-RR'));
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (21,'TrucAnh','namtqn1@gmail.com','0929323231','EF92B778BAFE771E89245B89ECBC08A44A4E166C06659911881F383D4473E94F','4 lưu chí hiếu,tây thạnh,tân phú',to_date('16-NOV-25','DD-MON-RR'));
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (22,'Nam','namtqn4@gmail.com','0988776655','A9222073D0D46D3C8EB307997FA3D634460F91117418198C0ADACAEF9B1304E2','4/7 Lưu Chí Hiếu',to_date('16-NOV-25','DD-MON-RR'));
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (23,'Tuong','namtqn3@gmail.com','0988776655','96CAE35CE8A9B0244178BF28E4966C2CE1B8385723A96A6B838858CDD6CA0A1E','4 lưu chí hiếu,tây thạnh,tân phú',to_date('16-NOV-25','DD-MON-RR'));
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (81,'Manager User','manager@vinfast.com','0900000002','EF92B778BAFE771E89245B89ECBC08A44A4E166C06659911881F383D4473E94F',null,to_date('05-DEC-25','DD-MON-RR'));
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (41,'Ana','namtqn8@gmail.com','+84971224228','810BCE6C7B4AB35B984461DE23C54A4D100A62BE5567EC8A3600E95AC7CEB072','4/7 Lưu Chí Hiếu',to_date('17-NOV-25','DD-MON-RR'));
Insert into CARSALE.CUSTOMER (MAKH,HOTEN,EMAIL,SDT,MATKHAU,DIACHI,NGAYDANGKY) values (61,'Admin','admin@vinfast.com','0900000001','EF92B778BAFE771E89245B89ECBC08A44A4E166C06659911881F383D4473E94F',null,to_date('04-DEC-25','DD-MON-RR'));
REM INSERTING into CARSALE.DATA_SECURITY_LABEL
SET DEFINE OFF;
Insert into CARSALE.DATA_SECURITY_LABEL (DATA_LABEL_ID,TABLE_NAME,RECORD_ID,SECURITY_LEVEL,COMPARTMENTS,CREATED_DATE) values (21,'CUSTOMER',81,1000,null,to_date('05-DEC-25','DD-MON-RR'));
Insert into CARSALE.DATA_SECURITY_LABEL (DATA_LABEL_ID,TABLE_NAME,RECORD_ID,SECURITY_LEVEL,COMPARTMENTS,CREATED_DATE) values (1,'CUSTOMER',61,1000,null,to_date('04-DEC-25','DD-MON-RR'));
REM INSERTING into CARSALE.ENCRYPTION_KEY
SET DEFINE OFF;
Insert into CARSALE.ENCRYPTION_KEY (KEYID,KEYTYPE,PUBLICKEY,PRIVATEKEY,CREATEDDATE) values (1,'RSA','96657768B61CA34727789F64A3F649413F33C72D59B0618C1D0B9F3458E6F79C0FB255E7AE40705A3EE72A495E088C717A973FBBFD48E32C5716701ABC940E3CF4A6829B604370CBCEB2F15F3B1EB54ED19CB6F8493D7C4534AD81D2ECA08474C63074EBFA69576AF701F8A2AADA4760604625AAA7F77A9723A5909F501D99F6D08B5903CB8078609D6CE4041DF3FD81606C46AF7291D9959548AEF68C73B8AF4A8F6E5A0BB6CC804A091302F86BC7CC7AC139930CDEEC5C28D44A5DC58053F8D6BB2A3D4DA58735D4FA65CEB7E1BCE416B9DBC2054F30D5C39385E24C4E49D5CDE659B240B683619116F42B82481820C0B06E8095945DD44E47172006D18B6E5055424C49435F4B45595F3230323531313231313633393437','96657768B61CA34727789F64A3F649413F33C72D59B0618C1D0B9F3458E6F79C0FB255E7AE40705A3EE72A495E088C717A973FBBFD48E32C5716701ABC940E3CF4A6829B604370CBCEB2F15F3B1EB54ED19CB6F8493D7C4534AD81D2ECA08474C63074EBFA69576AF701F8A2AADA4760604625AAA7F77A9723A5909F501D99F6D08B5903CB8078609D6CE4041DF3FD81606C46AF7291D9959548AEF68C73B8AF4A8F6E5A0BB6CC804A091302F86BC7CC7AC139930CDEEC5C28D44A5DC58053F8D6BB2A3D4DA58735D4FA65CEB7E1BCE416B9DBC2054F30D5C39385E24C4E49D5CDE659B240B683619116F42B82481820C0B06E8095945DD44E47172006D18B6E505249564154455F4B45595F3230323531313231313633393437',to_date('21-NOV-25','DD-MON-RR'));
Insert into CARSALE.ENCRYPTION_KEY (KEYID,KEYTYPE,PUBLICKEY,PRIVATEKEY,CREATEDDATE) values (2,'RSA','792134F9F0D57CA15E55C71D81AF727CF4C484F045BAA89EB5A8699DAD929E9BC0ED67534D2B5B023E232D1374CF80A1733C158970BCA98CBD1263904C11A7B674BE30021D15AA02E4702972471CE2B5F4A08BBD538EF2FD025F82235BA6DE8BC198E6F25BC3AA6C45D404D2DE6EB878B7E65AE159D6C0FA4C134245E03C4536FE2D6963C353E167BDCC9BF5E8D1B65B9036EA2E81CA98235F8F96865F724D9701F327B31D3FCE8CEEC5609FFB003508BC5DDCD584F5D1BD1C85A43238244CB44EB65F9306D4344DE625B5EB1242CEE353D3610C1139607D333302F55697AA6C41E3CF1BD36B72FD9D8D0D951233FC570F2625EF1024BB66312F66DD7DA1BB075055424C49435F4B45595F3230323531313231313634303435','792134F9F0D57CA15E55C71D81AF727CF4C484F045BAA89EB5A8699DAD929E9BC0ED67534D2B5B023E232D1374CF80A1733C158970BCA98CBD1263904C11A7B674BE30021D15AA02E4702972471CE2B5F4A08BBD538EF2FD025F82235BA6DE8BC198E6F25BC3AA6C45D404D2DE6EB878B7E65AE159D6C0FA4C134245E03C4536FE2D6963C353E167BDCC9BF5E8D1B65B9036EA2E81CA98235F8F96865F724D9701F327B31D3FCE8CEEC5609FFB003508BC5DDCD584F5D1BD1C85A43238244CB44EB65F9306D4344DE625B5EB1242CEE353D3610C1139607D333302F55697AA6C41E3CF1BD36B72FD9D8D0D951233FC570F2625EF1024BB66312F66DD7DA1BB07505249564154455F4B45595F3230323531313231313634303435',to_date('21-NOV-25','DD-MON-RR'));
Insert into CARSALE.ENCRYPTION_KEY (KEYID,KEYTYPE,PUBLICKEY,PRIVATEKEY,CREATEDDATE) values (3,'RSA','B5FA7328DBE77458D26B20D5A44421EB9BDAEBA5F5019141FD566552E9BDBCF16B96C3F45101C45043271DE82E4F3FD3E757BCCA60A6EC747352F3CAA4F8C778B87887E4A5F3669E3D58A9AFE53A33170908DC98F2625412592C486DFFF2CC311092605111AC925C9392FAAA99D4E92C86138725175DA4B97BC43A250627511B735BEFAB297993FDC3EF9128C4896259DB69A29AC9C2244D9194FF9AABADE494DE84B72081DE0ED2B1B3895BD793DAA5FF97BCEAD3DE0530F1F8D60BAF9E48FC9307DA7EB87780ECFE337FEA7ECA50CABDAE98FEE1FDADB3F7E4FFD57884A09B0005FDE3950097CCFF697A7A56931ABD52B6D68E108D182D69FB8A0CC36829EA5055424C49435F4B45595F3230323531313231313635303237','B5FA7328DBE77458D26B20D5A44421EB9BDAEBA5F5019141FD566552E9BDBCF16B96C3F45101C45043271DE82E4F3FD3E757BCCA60A6EC747352F3CAA4F8C778B87887E4A5F3669E3D58A9AFE53A33170908DC98F2625412592C486DFFF2CC311092605111AC925C9392FAAA99D4E92C86138725175DA4B97BC43A250627511B735BEFAB297993FDC3EF9128C4896259DB69A29AC9C2244D9194FF9AABADE494DE84B72081DE0ED2B1B3895BD793DAA5FF97BCEAD3DE0530F1F8D60BAF9E48FC9307DA7EB87780ECFE337FEA7ECA50CABDAE98FEE1FDADB3F7E4FFD57884A09B0005FDE3950097CCFF697A7A56931ABD52B6D68E108D182D69FB8A0CC36829EA505249564154455F4B45595F3230323531313231313635303237',to_date('21-NOV-25','DD-MON-RR'));
Insert into CARSALE.ENCRYPTION_KEY (KEYID,KEYTYPE,PUBLICKEY,PRIVATEKEY,CREATEDDATE) values (21,'RSA','854650DB1F44B3E086ED2F816A360B497BF3E450CF9400FEDB2DF2EFC396D1D3EABA89611A91A46BE50E4DF7BF8BA3CFFFB19B23E7FA4F444E4956F769A2C849E9C37A867FC5795DCB05678868E981CC6D2761614CC03191C8F6BE964A7B5FD7E31E9EFC5AB7F23D6CA32E1E230036E0F9DC3E2086F221BB4A97C8442D8F020836BE42D3DF12B7BE751A52609F5934E62B89BFFCE6EF120F06FFB037CF10FC0761370313060555654FE01903A4B4A13A85B3069AD2BA0CD2E5845E211219BC05A294717F0DF5A0A284962B19C54132F1B1CDCE6D31CB0CBD1D3EFD2143219F6BC6CD607BA4AB217ECAE3EA6FB0BE7121A9BDC76876366BD3ED474201D0CCFF845055424C49435F4B45595F3230323531313235313630343033','854650DB1F44B3E086ED2F816A360B497BF3E450CF9400FEDB2DF2EFC396D1D3EABA89611A91A46BE50E4DF7BF8BA3CFFFB19B23E7FA4F444E4956F769A2C849E9C37A867FC5795DCB05678868E981CC6D2761614CC03191C8F6BE964A7B5FD7E31E9EFC5AB7F23D6CA32E1E230036E0F9DC3E2086F221BB4A97C8442D8F020836BE42D3DF12B7BE751A52609F5934E62B89BFFCE6EF120F06FFB037CF10FC0761370313060555654FE01903A4B4A13A85B3069AD2BA0CD2E5845E211219BC05A294717F0DF5A0A284962B19C54132F1B1CDCE6D31CB0CBD1D3EFD2143219F6BC6CD607BA4AB217ECAE3EA6FB0BE7121A9BDC76876366BD3ED474201D0CCFF84505249564154455F4B45595F3230323531313235313630343033',to_date('25-NOV-25','DD-MON-RR'));
REM INSERTING into CARSALE.FEEDBACK
SET DEFINE OFF;
REM INSERTING into CARSALE.ORDERS
SET DEFINE OFF;
Insert into CARSALE.ORDERS (MADON,MAKH,NGAYDAT,TONGTIEN,TRANGTHAI) values (1,41,to_date('04-DEC-25','DD-MON-RR'),235000000,'Da huy');
Insert into CARSALE.ORDERS (MADON,MAKH,NGAYDAT,TONGTIEN,TRANGTHAI) values (2,41,to_date('04-DEC-25','DD-MON-RR'),3500000000,'Cho xu ly');
Insert into CARSALE.ORDERS (MADON,MAKH,NGAYDAT,TONGTIEN,TRANGTHAI) values (3,41,to_date('04-DEC-25','DD-MON-RR'),1890000000,'Hoan thanh');
REM INSERTING into CARSALE.ORDER_DETAIL
SET DEFINE OFF;
Insert into CARSALE.ORDER_DETAIL (MADON,MAXE,SOLUONG,DONGIA) values (1,14,1,235000000);
Insert into CARSALE.ORDER_DETAIL (MADON,MAXE,SOLUONG,DONGIA) values (2,18,1,3500000000);
Insert into CARSALE.ORDER_DETAIL (MADON,MAXE,SOLUONG,DONGIA) values (3,13,1,1890000000);
REM INSERTING into CARSALE.SECURITY_COMPARTMENT
SET DEFINE OFF;
Insert into CARSALE.SECURITY_COMPARTMENT (COMP_ID,COMP_NAME,COMP_CODE,DESCRIPTION,CREATED_DATE) values (1,'FINANCE','FIN','Phòng tài chính',to_date('17-NOV-25','DD-MON-RR'));
Insert into CARSALE.SECURITY_COMPARTMENT (COMP_ID,COMP_NAME,COMP_CODE,DESCRIPTION,CREATED_DATE) values (2,'SALES','SAL','Phòng kinh doanh',to_date('17-NOV-25','DD-MON-RR'));
Insert into CARSALE.SECURITY_COMPARTMENT (COMP_ID,COMP_NAME,COMP_CODE,DESCRIPTION,CREATED_DATE) values (3,'ADMIN','ADM','Quản trị',to_date('17-NOV-25','DD-MON-RR'));
REM INSERTING into CARSALE.SECURITY_LEVEL
SET DEFINE OFF;
Insert into CARSALE.SECURITY_LEVEL (LEVEL_ID,LEVEL_NAME,LEVEL_NUM,DESCRIPTION,CREATED_DATE) values (1,'PUBLIC',1000,'Thông tin công khai',to_date('17-NOV-25','DD-MON-RR'));
Insert into CARSALE.SECURITY_LEVEL (LEVEL_ID,LEVEL_NAME,LEVEL_NUM,DESCRIPTION,CREATED_DATE) values (2,'CONFIDENTIAL',2000,'Thông tin mật',to_date('17-NOV-25','DD-MON-RR'));
Insert into CARSALE.SECURITY_LEVEL (LEVEL_ID,LEVEL_NAME,LEVEL_NUM,DESCRIPTION,CREATED_DATE) values (3,'HIGHLY_CONFIDENTIAL',3000,'Thông tin tuyệt mật',to_date('17-NOV-25','DD-MON-RR'));
REM INSERTING into CARSALE.USER_SECURITY_LABEL
SET DEFINE OFF;
Insert into CARSALE.USER_SECURITY_LABEL (USER_LABEL_ID,MAKH,MAX_READ_LEVEL,MAX_WRITE_LEVEL,COMPARTMENTS,CREATED_DATE) values (21,81,1000,1000,null,to_date('05-DEC-25','DD-MON-RR'));
Insert into CARSALE.USER_SECURITY_LABEL (USER_LABEL_ID,MAKH,MAX_READ_LEVEL,MAX_WRITE_LEVEL,COMPARTMENTS,CREATED_DATE) values (1,61,1000,1000,null,to_date('04-DEC-25','DD-MON-RR'));
--------------------------------------------------------
--  DDL for Index PK_ORDER_DETAIL
--------------------------------------------------------

  CREATE UNIQUE INDEX "CARSALE"."PK_ORDER_DETAIL" ON "CARSALE"."ORDER_DETAIL" ("MADON", "MAXE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS" ;
--------------------------------------------------------
--  DDL for Trigger TRG_AUDIT_CAR
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "CARSALE"."TRG_AUDIT_CAR" 
AFTER INSERT OR UPDATE OR DELETE ON CAR
FOR EACH ROW
DECLARE
    v_action VARCHAR2(20);
BEGIN
    IF INSERTING THEN
        v_action := 'INSERT';
    ELSIF UPDATING THEN
        v_action := 'UPDATE';
    ELSIF DELETING THEN
        v_action := 'DELETE';
    END IF;

    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, 0, v_action, 'CAR', SYSDATE, SYS_CONTEXT('USERENV', 'IP_ADDRESS'));
END;

/
ALTER TRIGGER "CARSALE"."TRG_AUDIT_CAR" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_AUDIT_CUSTOMER_DELETE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "CARSALE"."TRG_AUDIT_CUSTOMER_DELETE" 
BEFORE DELETE ON CUSTOMER
FOR EACH ROW
BEGIN
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, :OLD.MAKH, 'DELETE', 'CUSTOMER', SYSDATE, SYS_CONTEXT('USERENV', 'IP_ADDRESS'));
END;

/
ALTER TRIGGER "CARSALE"."TRG_AUDIT_CUSTOMER_DELETE" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_AUDIT_CUSTOMER_INSERT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "CARSALE"."TRG_AUDIT_CUSTOMER_INSERT" 
AFTER INSERT ON CUSTOMER
FOR EACH ROW
BEGIN
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, :NEW.MAKH, 'INSERT', 'CUSTOMER', SYSDATE, SYS_CONTEXT('USERENV', 'IP_ADDRESS'));
END;

/
ALTER TRIGGER "CARSALE"."TRG_AUDIT_CUSTOMER_INSERT" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_AUDIT_CUSTOMER_UPDATE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "CARSALE"."TRG_AUDIT_CUSTOMER_UPDATE" 
AFTER UPDATE ON CUSTOMER
FOR EACH ROW
BEGIN
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, :NEW.MAKH, 'UPDATE', 'CUSTOMER', SYSDATE, SYS_CONTEXT('USERENV', 'IP_ADDRESS'));
END;

/
ALTER TRIGGER "CARSALE"."TRG_AUDIT_CUSTOMER_UPDATE" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_AUDIT_ORDERS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "CARSALE"."TRG_AUDIT_ORDERS" 
AFTER INSERT OR UPDATE OR DELETE ON ORDERS
FOR EACH ROW
DECLARE
    v_action VARCHAR2(20);
    v_makh NUMBER;
BEGIN
    IF INSERTING THEN
        v_action := 'INSERT';
        v_makh := :NEW.MAKH;
    ELSIF UPDATING THEN
        v_action := 'UPDATE';
        v_makh := :NEW.MAKH;
    ELSIF DELETING THEN
        v_action := 'DELETE';
        v_makh := :OLD.MAKH;
    END IF;

    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, v_makh, v_action, 'ORDERS', SYSDATE, SYS_CONTEXT('USERENV', 'IP_ADDRESS'));
END;

/
ALTER TRIGGER "CARSALE"."TRG_AUDIT_ORDERS" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_AUTO_LABEL_CUSTOMER
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "CARSALE"."TRG_AUTO_LABEL_CUSTOMER" 
AFTER INSERT ON CUSTOMER
FOR EACH ROW
BEGIN
    -- Gán label PUBLIC (1000) cho customer mới
    INSERT INTO DATA_SECURITY_LABEL (DATA_LABEL_ID, TABLE_NAME, RECORD_ID, SECURITY_LEVEL, COMPARTMENTS)
    VALUES (SEQ_DATA_LABEL.NEXTVAL, 'CUSTOMER', :NEW.MAKH, 1000, NULL);

    -- Gán user security label mặc định
    INSERT INTO USER_SECURITY_LABEL (USER_LABEL_ID, MAKH, MAX_READ_LEVEL, MAX_WRITE_LEVEL, COMPARTMENTS)
    VALUES (SEQ_USER_LABEL.NEXTVAL, :NEW.MAKH, 1000, 1000, NULL);
END;

/
ALTER TRIGGER "CARSALE"."TRG_AUTO_LABEL_CUSTOMER" ENABLE;
--------------------------------------------------------
--  DDL for Procedure SP_ARCHIVE_OLD_AUDIT_LOGS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_ARCHIVE_OLD_AUDIT_LOGS" (
    p_days_to_keep IN NUMBER DEFAULT 365,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_cutoff_date DATE;
    v_archived_count NUMBER;
BEGIN
    v_cutoff_date := SYSDATE - p_days_to_keep;

    -- Tạo archive table nếu chưa có
    BEGIN
        EXECUTE IMMEDIATE 'CREATE TABLE AUDIT_LOG_ARCHIVE AS SELECT * FROM AUDIT_LOG WHERE 1=0';
    EXCEPTION
        WHEN OTHERS THEN
            NULL; -- Table already exists
    END;

    -- Chuyển logs cũ sang archive
    INSERT INTO AUDIT_LOG_ARCHIVE
    SELECT * FROM AUDIT_LOG
    WHERE NGAYGIO < v_cutoff_date;

    v_archived_count := SQL%ROWCOUNT;

    -- Xóa logs đã archive
    DELETE FROM AUDIT_LOG
    WHERE NGAYGIO < v_cutoff_date;

    COMMIT;

    p_result := 1;
    p_message := 'Đã archive ' || v_archived_count || ' audit logs';

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_ASSIGN_DATA_SECURITY_LABEL
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_ASSIGN_DATA_SECURITY_LABEL" (
    p_table_name IN VARCHAR2,
    p_record_id IN NUMBER,
    p_security_level IN NUMBER,
    p_compartments IN VARCHAR2,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_count NUMBER;
BEGIN
    -- Kiểm tra đã có label chưa
    SELECT COUNT(*) INTO v_count 
    FROM DATA_SECURITY_LABEL 
    WHERE TABLE_NAME = p_table_name AND RECORD_ID = p_record_id;

    IF v_count > 0 THEN
        -- Update existing label
        UPDATE DATA_SECURITY_LABEL
        SET SECURITY_LEVEL = p_security_level,
            COMPARTMENTS = p_compartments
        WHERE TABLE_NAME = p_table_name AND RECORD_ID = p_record_id;
    ELSE
        -- Insert new label
        INSERT INTO DATA_SECURITY_LABEL (DATA_LABEL_ID, TABLE_NAME, RECORD_ID, SECURITY_LEVEL, COMPARTMENTS)
        VALUES (SEQ_DATA_LABEL.NEXTVAL, p_table_name, p_record_id, p_security_level, p_compartments);
    END IF;

    COMMIT;

    p_result := 1;
    p_message := 'Đã gán security label cho data thành công';

    -- Ghi audit log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, 0, 'ASSIGN_DATA_LABEL: ' || p_table_name, 'DATA_SECURITY_LABEL', SYSDATE, NULL);
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_ASSIGN_USER_SECURITY_LABEL
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_ASSIGN_USER_SECURITY_LABEL" (
    p_makh IN NUMBER,
    p_max_read_level IN NUMBER,
    p_max_write_level IN NUMBER,
    p_compartments IN VARCHAR2,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_count NUMBER;
BEGIN
    -- Kiểm tra user có tồn tại
    SELECT COUNT(*) INTO v_count FROM CUSTOMER WHERE MAKH = p_makh;

    IF v_count = 0 THEN
        p_result := 0;
        p_message := 'User không tồn tại';
        RETURN;
    END IF;

    -- Kiểm tra đã có label chưa
    SELECT COUNT(*) INTO v_count FROM USER_SECURITY_LABEL WHERE MAKH = p_makh;

    IF v_count > 0 THEN
        -- Update existing label
        UPDATE USER_SECURITY_LABEL
        SET MAX_READ_LEVEL = p_max_read_level,
            MAX_WRITE_LEVEL = p_max_write_level,
            COMPARTMENTS = p_compartments
        WHERE MAKH = p_makh;
    ELSE
        -- Insert new label
        INSERT INTO USER_SECURITY_LABEL (USER_LABEL_ID, MAKH, MAX_READ_LEVEL, MAX_WRITE_LEVEL, COMPARTMENTS)
        VALUES (SEQ_USER_LABEL.NEXTVAL, p_makh, p_max_read_level, p_max_write_level, p_compartments);
    END IF;

    COMMIT;

    p_result := 1;
    p_message := 'Đã gán security label cho user thành công';

    -- Ghi audit log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, p_makh, 'ASSIGN_SECURITY_LABEL', 'USER_SECURITY_LABEL', SYSDATE, NULL);
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_BACKUP_ENCRYPTED_DATA
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_BACKUP_ENCRYPTED_DATA" (
    p_table_name IN VARCHAR2,
    p_backup_name IN VARCHAR2,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_sql VARCHAR2(4000);
    v_count NUMBER;
BEGIN
    -- Tạo backup table
    v_sql := 'CREATE TABLE ' || p_backup_name || ' AS SELECT * FROM ' || p_table_name;
    EXECUTE IMMEDIATE v_sql;

    -- Đếm số records
    v_sql := 'SELECT COUNT(*) FROM ' || p_backup_name;
    EXECUTE IMMEDIATE v_sql INTO v_count;

    -- Ghi log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, 0, 'BACKUP', p_table_name || ' -> ' || p_backup_name, SYSDATE, NULL);
    COMMIT;

    p_result := 1;
    p_message := 'Backup thành công ' || v_count || ' records từ ' || p_table_name;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_CREATE_ORDER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_CREATE_ORDER" (
    p_makh IN NUMBER,
    p_maxe IN NUMBER,
    p_soluong IN NUMBER,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2,
    p_madon OUT NUMBER
)
AS
    v_dongia NUMBER(12,2);
    v_tongtien NUMBER(12,2);
    v_count NUMBER;
BEGIN
    -- Kiểm tra xe tồn tại
    SELECT COUNT(*), MAX(GIA) 
    INTO v_count, v_dongia
    FROM CAR 
    WHERE MAXE = p_maxe AND TRANGTHAI = 'Con hang';

    IF v_count = 0 THEN
        p_result := 0;
        p_message := 'Xe không tồn tại hoặc đã hết hàng';
        p_madon := NULL;
        RETURN;
    END IF;

    -- Tính tổng tiền
    v_tongtien := v_dongia * p_soluong;

    -- Tạo đơn hàng
    SELECT SEQ_ORDER. NEXTVAL INTO p_madon FROM DUAL;

    INSERT INTO ORDERS (MADON, MAKH, NGAYDAT, TONGTIEN, TRANGTHAI)
    VALUES (p_madon, p_makh, SYSDATE, v_tongtien, 'Cho xu ly');

    -- Tạo chi tiết đơn hàng
    INSERT INTO ORDER_DETAIL (MADON, MAXE, SOLUONG, DONGIA)
    VALUES (p_madon, p_maxe, p_soluong, v_dongia);

    -- Cập nhật trạng thái xe
    UPDATE CAR 
    SET TRANGTHAI = 'Het hang'
    WHERE MAXE = p_maxe;

    COMMIT;

    p_result := 1;
    p_message := 'Tạo đơn hàng thành công';

    -- Ghi audit log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, p_makh, 'CREATE_ORDER', 'ORDERS', SYSDATE, NULL);
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
        p_madon := NULL;
END;

/

  GRANT EXECUTE ON "CARSALE"."SP_CREATE_ORDER" TO "CARSALE_ADMIN_ROLE";
--------------------------------------------------------
--  DDL for Procedure SP_DECRYPT_WITH_PRIVATE_KEY
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_DECRYPT_WITH_PRIVATE_KEY" (
    p_encrypted_data IN VARCHAR2,
    p_keyid IN NUMBER,
    p_decrypted_data OUT VARCHAR2,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_private_key VARCHAR2(4000);
    v_decryption_key RAW(32);
    v_iv RAW(16);
    v_encrypted_raw RAW(2000);
    v_decrypted_raw RAW(2000);
    v_separator_pos NUMBER;
BEGIN
    -- Lấy private key
    SELECT PRIVATEKEY INTO v_private_key
    FROM ENCRYPTION_KEY
    WHERE KEYID = p_keyid;

    -- Tạo key giải mã từ private key (dùng cùng thuật toán với encrypt)
    v_decryption_key := DBMS_CRYPTO.HASH(
        HEXTORAW(v_private_key),
        DBMS_CRYPTO.HASH_SH256
    );

    -- Tách IV và encrypted data (format: IV:ENCRYPTED_DATA)
    v_separator_pos := INSTR(p_encrypted_data, ':');

    IF v_separator_pos = 0 THEN
        p_result := 0;
        p_message := 'Định dạng dữ liệu mã hóa không hợp lệ';
        RETURN;
    END IF;

    v_iv := HEXTORAW(SUBSTR(p_encrypted_data, 1, v_separator_pos - 1));
    v_encrypted_raw := HEXTORAW(SUBSTR(p_encrypted_data, v_separator_pos + 1));

    -- Giải mã
    v_decrypted_raw := DBMS_CRYPTO.DECRYPT(
        src => v_encrypted_raw,
        typ => DBMS_CRYPTO.ENCRYPT_AES256 + DBMS_CRYPTO.CHAIN_CBC + DBMS_CRYPTO.PAD_PKCS5,
        key => v_decryption_key,
        iv  => v_iv
    );

    p_decrypted_data := UTL_RAW.CAST_TO_VARCHAR2(v_decrypted_raw);
    p_result := 1;
    p_message := 'Giải mã thành công';

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_result := 0;
        p_message := 'Không tìm thấy key với ID: ' || p_keyid;
    WHEN OTHERS THEN
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_DETECT_ANOMALIES
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_DETECT_ANOMALIES" (
    p_report OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_report FOR
    -- Phát hiện login từ nhiều IP khác nhau trong 1 giờ
    SELECT 
        'Multiple IPs' AS ANOMALY_TYPE,
        al.MATK,
        c.EMAIL,
        COUNT(DISTINCT al.IP) AS DISTINCT_IPS,
        TO_CHAR(al.NGAYGIO, 'YYYY-MM-DD HH24:MI:SS') AS TIME_WINDOW
    FROM AUDIT_LOG al
    JOIN CUSTOMER c ON al.MATK = c.MAKH
    WHERE al.HANHDONG = 'LOGIN'
    AND al.NGAYGIO >= SYSDATE - 1/24
    GROUP BY al.MATK, c.EMAIL, TO_CHAR(al.NGAYGIO, 'YYYY-MM-DD HH24:MI:SS')
    HAVING COUNT(DISTINCT al.IP) > 3

    UNION ALL

    -- Phát hiện quá nhiều failed attempts
    SELECT 
        'Too Many Failed Logins' AS ANOMALY_TYPE,
        al.MATK,
        c.EMAIL,
        COUNT(*) AS ATTEMPT_COUNT,
        TO_CHAR(MAX(al.NGAYGIO), 'YYYY-MM-DD HH24:MI:SS') AS LAST_ATTEMPT
    FROM AUDIT_LOG al
    LEFT JOIN CUSTOMER c ON al.MATK = c.MAKH
    WHERE al.HANHDONG LIKE 'ACCESS_DENIED%'
    AND al.NGAYGIO >= SYSDATE - 1
    GROUP BY al.MATK, c.EMAIL
    HAVING COUNT(*) > 5

    UNION ALL

    -- Phát hiện truy cập bất thường vào dữ liệu nhạy cảm
    SELECT 
        'Unusual Sensitive Data Access' AS ANOMALY_TYPE,
        al.MATK,
        c.EMAIL,
        COUNT(*) AS ACCESS_COUNT,
        TO_CHAR(MAX(al.NGAYGIO), 'YYYY-MM-DD HH24:MI:SS') AS LAST_ACCESS
    FROM AUDIT_LOG al
    LEFT JOIN CUSTOMER c ON al.MATK = c.MAKH
    WHERE al.BANGTACDONG = 'CUSTOMER'
    AND al.HANHDONG IN ('SELECT', 'UPDATE')
    AND al.NGAYGIO >= SYSDATE - 1
    GROUP BY al.MATK, c.EMAIL
    HAVING COUNT(*) > 50;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_ENCRYPT_WITH_PUBLIC_KEY
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_ENCRYPT_WITH_PUBLIC_KEY" (
    p_data IN VARCHAR2,
    p_keyid IN NUMBER,
    p_encrypted_data OUT VARCHAR2,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_public_key VARCHAR2(4000);
    v_raw_data RAW(2000);
    v_encryption_key RAW(32);  -- 32 bytes = 256 bits cho AES256
    v_iv RAW(16);              -- Initialization Vector 16 bytes
BEGIN
    -- Lấy public key
    SELECT PUBLICKEY INTO v_public_key
    FROM ENCRYPTION_KEY
    WHERE KEYID = p_keyid AND KEYTYPE = 'RSA';

    -- Tạo key mã hóa 32 bytes từ public key
    -- Dùng HASH SHA-256 để đảm bảo luôn có 32 bytes
    v_encryption_key := DBMS_CRYPTO.HASH(
        HEXTORAW(v_public_key),
        DBMS_CRYPTO.HASH_SH256
    );

    -- Tạo IV (Initialization Vector) ngẫu nhiên
    v_iv := DBMS_CRYPTO.RANDOMBYTES(16);

    -- Mã hóa dữ liệu với AES256 + CBC + PKCS5 Padding
    v_raw_data := UTL_RAW.CAST_TO_RAW(p_data);

    p_encrypted_data := RAWTOHEX(v_iv) || ':' || RAWTOHEX(
        DBMS_CRYPTO.ENCRYPT(
            src => v_raw_data,
            typ => DBMS_CRYPTO.ENCRYPT_AES256 + DBMS_CRYPTO.CHAIN_CBC + DBMS_CRYPTO.PAD_PKCS5,
            key => v_encryption_key,
            iv  => v_iv
        )
    );

    p_result := 1;
    p_message := 'Mã hóa thành công';

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_result := 0;
        p_message := 'Không tìm thấy key với ID: ' || p_keyid;
    WHEN OTHERS THEN
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_EXECUTE_WITH_RBAC
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_EXECUTE_WITH_RBAC" (
    p_makh IN NUMBER,
    p_action IN VARCHAR2,
    p_resource IN VARCHAR2,
    p_sql IN VARCHAR2,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_has_permission NUMBER;
BEGIN
    -- Kiểm tra quyền
    v_has_permission := FN_CHECK_USER_PERMISSION(p_makh, p_action, p_resource);

    IF v_has_permission = 0 THEN
        p_result := 0;
        p_message := 'Không có quyền thực hiện hành động này';

        -- Ghi log từ chối
        INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
        VALUES (SEQ_LOG.NEXTVAL, p_makh, 'ACCESS_DENIED: ' || p_action, p_resource, SYSDATE, NULL);
        COMMIT;

        RETURN;
    END IF;

    -- Thực thi SQL nếu có quyền
    EXECUTE IMMEDIATE p_sql;

    p_result := 1;
    p_message := 'Thực hiện thành công';

    -- Ghi log thành công
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, p_makh, 'ACCESS_GRANTED: ' || p_action, p_resource, SYSDATE, NULL);
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_GENERATE_COMPLIANCE_REPORT
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_GENERATE_COMPLIANCE_REPORT" (
    p_start_date IN DATE,
    p_end_date IN DATE,
    p_report OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_report FOR
    SELECT 
        'USER_AUTHENTICATION' AS CATEGORY,
        COUNT(CASE WHEN HANHDONG = 'LOGIN' THEN 1 END) AS SUCCESSFUL_LOGINS,
        COUNT(CASE WHEN HANHDONG = 'LOGOUT' THEN 1 END) AS LOGOUTS,
        COUNT(CASE WHEN HANHDONG LIKE 'ACCESS_DENIED%' THEN 1 END) AS FAILED_ATTEMPTS,
        COUNT(DISTINCT MATK) AS UNIQUE_USERS,
        COUNT(DISTINCT IP) AS UNIQUE_IPS
    FROM AUDIT_LOG
    WHERE NGAYGIO BETWEEN p_start_date AND p_end_date

    UNION ALL

    SELECT 
        'DATA_MODIFICATIONS' AS CATEGORY,
        COUNT(CASE WHEN HANHDONG = 'INSERT' THEN 1 END) AS INSERTS,
        COUNT(CASE WHEN HANHDONG = 'UPDATE' THEN 1 END) AS UPDATES,
        COUNT(CASE WHEN HANHDONG = 'DELETE' THEN 1 END) AS DELETES,
        COUNT(DISTINCT MATK) AS USERS_MODIFIED,
        COUNT(DISTINCT BANGTACDONG) AS TABLES_AFFECTED
    FROM AUDIT_LOG
    WHERE NGAYGIO BETWEEN p_start_date AND p_end_date
    AND HANHDONG IN ('INSERT', 'UPDATE', 'DELETE')

    UNION ALL

    SELECT 
        'AUTHORIZATION_CHANGES' AS CATEGORY,
        COUNT(CASE WHEN HANHDONG LIKE 'GRANT%' THEN 1 END) AS GRANTS,
        COUNT(CASE WHEN HANHDONG LIKE 'REVOKE%' THEN 1 END) AS REVOKES,
        NULL AS COL3,
        NULL AS COL4,
        NULL AS COL5
    FROM AUDIT_LOG
    WHERE NGAYGIO BETWEEN p_start_date AND p_end_date
    AND (HANHDONG LIKE 'GRANT%' OR HANHDONG LIKE 'REVOKE%');
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_GENERATE_RSA_KEYPAIR
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_GENERATE_RSA_KEYPAIR" (
    p_key_size IN NUMBER DEFAULT 2048,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_random_bytes RAW(256);
    v_private_key RAW(2048);
    v_public_key RAW(2048);
    v_keyid NUMBER;
    v_timestamp VARCHAR2(50);
BEGIN
    -- Generate random bytes cho key
    v_random_bytes := DBMS_CRYPTO.RANDOMBYTES(256);

    -- Tạo timestamp unique - SỬA LỖI Ở ĐÂY
    v_timestamp := TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS');

    -- Tạo key pair (simplified version)
    v_public_key := UTL_RAW.CONCAT(
        v_random_bytes,
        UTL_RAW.CAST_TO_RAW('PUBLIC_KEY_' || v_timestamp)
    );

    v_private_key := UTL_RAW.CONCAT(
        v_random_bytes,
        UTL_RAW.CAST_TO_RAW('PRIVATE_KEY_' || v_timestamp)
    );

    -- Lưu vào database
    SELECT SEQ_KEY.NEXTVAL INTO v_keyid FROM DUAL;

    INSERT INTO ENCRYPTION_KEY (KEYID, KEYTYPE, PUBLICKEY, PRIVATEKEY, CREATEDDATE)
    VALUES (v_keyid, 'RSA', RAWTOHEX(v_public_key), RAWTOHEX(v_private_key), SYSDATE);

    COMMIT;

    p_result := 1;
    p_message := 'Tạo RSA key pair thành công. KeyID: ' || v_keyid;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_GET_MY_ORDERS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_GET_MY_ORDERS" (
    p_makh IN NUMBER,
    p_orders OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_orders FOR
    SELECT 
        o.MADON,
        o.NGAYDAT,
        o. TONGTIEN,
        o. TRANGTHAI,
        od.MAXE,
        c.TENXE,
        c.HANGXE,
        c. HINHANH,
        od.SOLUONG,
        od.DONGIA
    FROM ORDERS o
    JOIN ORDER_DETAIL od ON o. MADON = od.MADON
    JOIN CAR c ON od.MAXE = c. MAXE
    WHERE o. MAKH = p_makh
    ORDER BY o.NGAYDAT DESC;
END;

/

  GRANT EXECUTE ON "CARSALE"."SP_GET_MY_ORDERS" TO "CARSALE_ADMIN_ROLE";
--------------------------------------------------------
--  DDL for Procedure SP_GET_ORDER_DETAIL
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_GET_ORDER_DETAIL" (
    p_madon IN NUMBER,
    p_result OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_result FOR
    SELECT 
        o. MADON,
        o. MAKH,
        cust.HOTEN,
        cust.EMAIL,
        cust.SDT,
        cust.DIACHI,
        o.NGAYDAT,
        o. TONGTIEN,
        o. TRANGTHAI,
        od.MAXE,
        c.TENXE,
        c.HANGXE,
        c.HINHANH,
        c.MOTA,
        od.SOLUONG,
        od.DONGIA
    FROM ORDERS o
    JOIN CUSTOMER cust ON o.MAKH = cust.MAKH
    JOIN ORDER_DETAIL od ON o.MADON = od.MADON
    JOIN CAR c ON od.MAXE = c.MAXE
    WHERE o.MADON = p_madon;
END;

/

  GRANT EXECUTE ON "CARSALE"."SP_GET_ORDER_DETAIL" TO "CARSALE_ADMIN_ROLE";
--------------------------------------------------------
--  DDL for Procedure SP_GRANT_USER_PERMISSION
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_GRANT_USER_PERMISSION" (
    p_username IN VARCHAR2,
    p_role IN VARCHAR2,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_sql VARCHAR2(500);
BEGIN
    v_sql := 'GRANT ' || p_role || ' TO ' || p_username;
    EXECUTE IMMEDIATE v_sql;

    -- Ghi log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, 0, 'GRANT_ROLE: ' || p_role, 'USER: ' || p_username, SYSDATE, NULL);
    COMMIT;

    p_result := 1;
    p_message := 'Đã grant role ' || p_role || ' cho user ' || p_username;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_LOGIN_CUSTOMER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_LOGIN_CUSTOMER" (
    p_email     IN VARCHAR2,
    p_matkhau   IN VARCHAR2,
    p_ip        IN VARCHAR2,
    p_result    OUT NUMBER,
    p_message   OUT VARCHAR2,
    p_makh      OUT NUMBER,
    p_hoten     OUT VARCHAR2,
    p_rolename  OUT VARCHAR2
)
AS
    v_encrypted_password VARCHAR2(256);
    v_stored_password VARCHAR2(256);
    v_count NUMBER;
BEGIN
    -- Mã hóa mật khẩu nhập vào
    v_encrypted_password := DBMS_CRYPTO.HASH(
        UTL_RAW.CAST_TO_RAW(p_matkhau),
        DBMS_CRYPTO.HASH_SH256
    );

    -- Kiểm tra thông tin đăng nhập
    SELECT COUNT(*), MAX(c.MAKH), MAX(c.HOTEN), MAX(ar.ROLENAME)
    INTO v_count, p_makh, p_hoten, p_rolename
    FROM CUSTOMER c
    LEFT JOIN ACCOUNT_ROLE ar ON c.MAKH = ar.MAKH
    WHERE c.EMAIL = p_email 
    AND c.MATKHAU = v_encrypted_password;

    IF v_count = 0 THEN
        p_result := 0;
        p_message := 'Email hoặc mật khẩu không đúng';
        p_makh := NULL;
        p_hoten := NULL;
        p_rolename := NULL;
        RETURN;
    END IF;

    p_result := 1;
    p_message := 'Đăng nhập thành công';

    -- Ghi audit log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, p_makh, 'LOGIN', 'CUSTOMER', SYSDATE, p_ip);
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
        p_makh := NULL;
        p_hoten := NULL;
        p_rolename := NULL;
END;

/

  GRANT EXECUTE ON "CARSALE"."SP_LOGIN_CUSTOMER" TO "CARSALE_ADMIN_ROLE";
--------------------------------------------------------
--  DDL for Procedure SP_LOGIN_CUSTOMER_WITH_MAC
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_LOGIN_CUSTOMER_WITH_MAC" (
    p_email     IN VARCHAR2,
    p_matkhau   IN VARCHAR2,
    p_ip        IN VARCHAR2,
    p_result    OUT NUMBER,
    p_message   OUT VARCHAR2,
    p_makh      OUT NUMBER,
    p_hoten     OUT VARCHAR2,
    p_rolename  OUT VARCHAR2
)
AS
    v_encrypted_password VARCHAR2(256);
    v_count NUMBER;
BEGIN
    -- Mã hóa mật khẩu nhập vào
    v_encrypted_password := DBMS_CRYPTO.HASH(
        UTL_RAW.CAST_TO_RAW(p_matkhau),
        DBMS_CRYPTO.HASH_SH256
    );

    -- Kiểm tra thông tin đăng nhập
    SELECT COUNT(*), MAX(c.MAKH), MAX(c.HOTEN), MAX(ar.ROLENAME)
    INTO v_count, p_makh, p_hoten, p_rolename
    FROM CUSTOMER c
    LEFT JOIN ACCOUNT_ROLE ar ON c.MAKH = ar.MAKH
    WHERE c.EMAIL = p_email 
    AND c.MATKHAU = v_encrypted_password;

    IF v_count = 0 THEN
        p_result := 0;
        p_message := 'Email hoặc mật khẩu không đúng';
        p_makh := NULL;
        p_hoten := NULL;
        p_rolename := NULL;
        RETURN;
    END IF;

    -- SET SECURITY CONTEXT
    PKG_SECURITY_CONTEXT.SET_USER_CONTEXT(p_makh);

    p_result := 1;
    p_message := 'Đăng nhập thành công với MAC';

    -- Ghi audit log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, p_makh, 'LOGIN_WITH_MAC', 'CUSTOMER', SYSDATE, p_ip);
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
        p_makh := NULL;
        p_hoten := NULL;
        p_rolename := NULL;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_LOGOUT_CUSTOMER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_LOGOUT_CUSTOMER" (
    p_makh      IN NUMBER,
    p_ip        IN VARCHAR2,
    p_result    OUT NUMBER,
    p_message   OUT VARCHAR2
)
AS
BEGIN
    -- Ghi audit log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, p_makh, 'LOGOUT', 'CUSTOMER', SYSDATE, p_ip);
    COMMIT;

    p_result := 1;
    p_message := 'Đăng xuất thành công';

EXCEPTION
    WHEN OTHERS THEN
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/

  GRANT EXECUTE ON "CARSALE"."SP_LOGOUT_CUSTOMER" TO "CARSALE_ADMIN_ROLE";
--------------------------------------------------------
--  DDL for Procedure SP_MANAGE_USER_SESSION
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_MANAGE_USER_SESSION" (
    p_username IN VARCHAR2,
    p_action IN VARCHAR2, -- 'KILL', 'CHECK', 'LIST'
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_sid NUMBER;
    v_serial# NUMBER;
    v_count NUMBER;
    v_sql VARCHAR2(500);
BEGIN
    IF p_action = 'CHECK' THEN
        -- Kiểm tra số session của user
        SELECT COUNT(*) INTO v_count
        FROM V$SESSION
        WHERE USERNAME = UPPER(p_username);

        p_result := 1;
        p_message := 'User ' || p_username || ' có ' || v_count || ' session(s)';

    ELSIF p_action = 'KILL' THEN
        -- Kill tất cả session của user
        FOR rec IN (SELECT SID, SERIAL# FROM V$SESSION WHERE USERNAME = UPPER(p_username)) LOOP
            v_sql := 'ALTER SYSTEM KILL SESSION ''' || rec.SID || ',' || rec.SERIAL# || ''' IMMEDIATE';
            EXECUTE IMMEDIATE v_sql;
        END LOOP;

        p_result := 1;
        p_message := 'Đã kill session của user ' || p_username;

    ELSIF p_action = 'LIST' THEN
        -- List session info
        p_result := 1;
        p_message := 'Xem V$SESSION để biết chi tiết';
    END IF;

EXCEPTION
    WHEN OTHERS THEN
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_REENCRYPT_PASSWORDS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_REENCRYPT_PASSWORDS" (
    p_old_algorithm IN VARCHAR2 DEFAULT 'SHA256',
    p_new_algorithm IN VARCHAR2 DEFAULT 'SHA512',
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_count NUMBER := 0;
    CURSOR c_customers IS
        SELECT MAKH, EMAIL, MATKHAU FROM CUSTOMER;
BEGIN
    -- Backup dữ liệu cũ
    EXECUTE IMMEDIATE 'CREATE TABLE CUSTOMER_BACKUP AS SELECT * FROM CUSTOMER';

    -- Re-encrypt với thuật toán mới
    FOR rec IN c_customers LOOP
        -- Trong thực tế, cần decrypt rồi encrypt lại
        -- Đây là demo: hash lại password hiện tại
        UPDATE CUSTOMER
        SET MATKHAU = DBMS_CRYPTO.HASH(
            UTL_RAW.CAST_TO_RAW(MATKHAU),
            CASE p_new_algorithm
                WHEN 'SHA512' THEN DBMS_CRYPTO.HASH_SH512
                WHEN 'SHA384' THEN DBMS_CRYPTO.HASH_SH384
                ELSE DBMS_CRYPTO.HASH_SH256
            END
        )
        WHERE MAKH = rec.MAKH;

        v_count := v_count + 1;
    END LOOP;

    COMMIT;

    p_result := 1;
    p_message := 'Đã mã hóa lại ' || v_count || ' mật khẩu';

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_REGISTER_CUSTOMER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_REGISTER_CUSTOMER" (
    p_hoten     IN VARCHAR2,
    p_email     IN VARCHAR2,
    p_sdt       IN VARCHAR2,
    p_matkhau   IN VARCHAR2,
    p_diachi    IN VARCHAR2,
    p_result    OUT NUMBER,
    p_message   OUT VARCHAR2,
    p_makh      OUT NUMBER
)
AS
    v_count NUMBER;
    v_encrypted_password VARCHAR2(256);
BEGIN
    -- Kiểm tra email đã tồn tại chưa
    SELECT COUNT(*) INTO v_count 
    FROM CUSTOMER 
    WHERE EMAIL = p_email;

    IF v_count > 0 THEN
        p_result := 0;
        p_message := 'Email đã được sử dụng';
        p_makh := NULL;
        RETURN;
    END IF;

    -- Mã hóa mật khẩu bằng SHA-256
    v_encrypted_password := DBMS_CRYPTO.HASH(
        UTL_RAW.CAST_TO_RAW(p_matkhau),
        DBMS_CRYPTO.HASH_SH256
    );

    -- Lấy ID mới từ sequence
    SELECT SEQ_CUSTOMER.NEXTVAL INTO p_makh FROM DUAL;

    -- Thêm customer mới
    INSERT INTO CUSTOMER (MAKH, HOTEN, EMAIL, SDT, MATKHAU, DIACHI, NGAYDANGKY)
    VALUES (p_makh, p_hoten, p_email, p_sdt, v_encrypted_password, p_diachi, SYSDATE);

    -- Tạo role mặc định cho customer
    INSERT INTO ACCOUNT_ROLE (MATK, MAKH, ROLENAME)
    VALUES (p_makh, p_makh, 'CUSTOMER');

    COMMIT;

    p_result := 1;
    p_message := 'Đăng ký thành công';

    -- Ghi audit log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, p_makh, 'REGISTER', 'CUSTOMER', SYSDATE, NULL);
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
        p_makh := NULL;
END;

/

  GRANT EXECUTE ON "CARSALE"."SP_REGISTER_CUSTOMER" TO "CARSALE_ADMIN_ROLE";
--------------------------------------------------------
--  DDL for Procedure SP_ROTATE_ENCRYPTION_KEYS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_ROTATE_ENCRYPTION_KEYS" (
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_old_key_count NUMBER;
    v_new_keyid NUMBER;
BEGIN
    -- Đếm số key cũ
    SELECT COUNT(*) INTO v_old_key_count FROM ENCRYPTION_KEY;

    -- Archive old keys (đánh dấu là expired)
    UPDATE ENCRYPTION_KEY 
    SET KEYTYPE = 'RSA_EXPIRED'
    WHERE KEYTYPE = 'RSA';

    -- Generate new key
    SP_GENERATE_RSA_KEYPAIR(2048, p_result, p_message);

    IF p_result = 1 THEN
        p_message := 'Key rotation thành công. Archived ' || v_old_key_count || ' old keys.';
    END IF;

    -- Ghi log
    INSERT INTO AUDIT_LOG (MALOG, MATK, HANHDONG, BANGTACDONG, NGAYGIO, IP)
    VALUES (SEQ_LOG.NEXTVAL, 0, 'KEY_ROTATION', 'ENCRYPTION_KEY', SYSDATE, NULL);
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_SECURITY_HEALTH_CHECK
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_SECURITY_HEALTH_CHECK" (
    p_report OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_report FOR
    SELECT 
        'Weak Password Users' AS ISSUE_TYPE,
        COUNT(*) AS COUNT,
        'Users with simple passwords' AS DESCRIPTION
    FROM CUSTOMER
    WHERE LENGTH(MATKHAU) < 64
    UNION ALL
    SELECT 
        'Inactive Users' AS ISSUE_TYPE,
        COUNT(*) AS COUNT,
        'Users not logged in for 90 days' AS DESCRIPTION
    FROM CUSTOMER c
    WHERE NOT EXISTS (
        SELECT 1 FROM AUDIT_LOG al
        WHERE al.MATK = c.MAKH 
        AND al.HANHDONG = 'LOGIN'
        AND al.NGAYGIO >= SYSDATE - 90
    )
    UNION ALL
    SELECT 
        'Failed Login Attempts' AS ISSUE_TYPE,
        COUNT(*) AS COUNT,
        'Access denied in last 24 hours' AS DESCRIPTION
    FROM AUDIT_LOG
    WHERE HANHDONG LIKE 'ACCESS_DENIED%'
    AND NGAYGIO >= SYSDATE - 1
    UNION ALL
    SELECT 
        'High Value Orders' AS ISSUE_TYPE,
        COUNT(*) AS COUNT,
        'Orders > 1 billion VND' AS DESCRIPTION
    FROM ORDERS
    WHERE TONGTIEN > 1000000000;
END;

/
--------------------------------------------------------
--  DDL for Procedure SP_TEST_ALL_SECURITY_FEATURES
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_TEST_ALL_SECURITY_FEATURES" 
AS
    v_result NUMBER;
    v_message VARCHAR2(4000);
    v_encrypted VARCHAR2(4000);
    v_cursor SYS_REFCURSOR;
    v_test_count NUMBER := 0;
    v_pass_count NUMBER := 0;
BEGIN
    DBMS_OUTPUT.PUT_LINE('=== BẮT ĐẦU TEST BẢO MẬT ===');
    DBMS_OUTPUT.PUT_LINE('');

    -- Test 1: RSA Key Generation
    v_test_count := v_test_count + 1;
    BEGIN
        SP_GENERATE_RSA_KEYPAIR(2048, v_result, v_message);
        IF v_result = 1 THEN
            v_pass_count := v_pass_count + 1;
            DBMS_OUTPUT.PUT_LINE('[PASS] Test 1: RSA Key Generation - ' || v_message);
        ELSE
            DBMS_OUTPUT.PUT_LINE('[FAIL] Test 1: RSA Key Generation - ' || v_message);
        END IF;
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('[ERROR] Test 1: ' || SQLERRM);
    END;

    -- Test 2: Encryption
    v_test_count := v_test_count + 1;
    BEGIN
        SP_ENCRYPT_WITH_PUBLIC_KEY('Test Data', 1, v_encrypted, v_result, v_message);
        IF v_result = 1 THEN
            v_pass_count := v_pass_count + 1;
            DBMS_OUTPUT.PUT_LINE('[PASS] Test 2: Data Encryption');
        ELSE
            DBMS_OUTPUT.PUT_LINE('[FAIL] Test 2: Data Encryption - ' || v_message);
        END IF;
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('[ERROR] Test 2: ' || SQLERRM);
    END;

    -- Test 3: RBAC Permission Check
    v_test_count := v_test_count + 1;
    BEGIN
        v_result := FN_CHECK_USER_PERMISSION(1, 'VIEW', 'CAR');
        IF v_result >= 0 THEN
            v_pass_count := v_pass_count + 1;
            DBMS_OUTPUT.PUT_LINE('[PASS] Test 3: RBAC Permission Check');
        ELSE
            DBMS_OUTPUT.PUT_LINE('[FAIL] Test 3: RBAC Permission Check');
        END IF;
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('[ERROR] Test 3: ' || SQLERRM);
    END;

    -- Test 4: Security Health Check
    v_test_count := v_test_count + 1;
    BEGIN
        SP_SECURITY_HEALTH_CHECK(v_cursor);
        CLOSE v_cursor;
        v_pass_count := v_pass_count + 1;
        DBMS_OUTPUT.PUT_LINE('[PASS] Test 4: Security Health Check');
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('[ERROR] Test 4: ' || SQLERRM);
    END;

    -- Test 5: Anomaly Detection
    v_test_count := v_test_count + 1;
    BEGIN
        SP_DETECT_ANOMALIES(v_cursor);
        CLOSE v_cursor;
        v_pass_count := v_pass_count + 1;
        DBMS_OUTPUT.PUT_LINE('[PASS] Test 5: Anomaly Detection');
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('[ERROR] Test 5: ' || SQLERRM);
    END;

    -- Test 6: Backup Procedure
    v_test_count := v_test_count + 1;
    BEGIN
        SP_BACKUP_ENCRYPTED_DATA('CUSTOMER', 'CUSTOMER_TEST_BACKUP', v_result, v_message);
        IF v_result = 1 THEN
            v_pass_count := v_pass_count + 1;
            DBMS_OUTPUT.PUT_LINE('[PASS] Test 6: Backup Procedure');
            -- Cleanup
            EXECUTE IMMEDIATE 'DROP TABLE CUSTOMER_TEST_BACKUP';
        ELSE
            DBMS_OUTPUT.PUT_LINE('[FAIL] Test 6: Backup Procedure - ' || v_message);
        END IF;
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('[ERROR] Test 6: ' || SQLERRM);
    END;

    DBMS_OUTPUT.PUT_LINE('');
    DBMS_OUTPUT.PUT_LINE('=== KẾT QUẢ TEST ===');
    DBMS_OUTPUT.PUT_LINE('Tổng số test: ' || v_test_count);
    DBMS_OUTPUT.PUT_LINE('Passed: ' || v_pass_count);
    DBMS_OUTPUT.PUT_LINE('Failed: ' || (v_test_count - v_pass_count));
    DBMS_OUTPUT.PUT_LINE('Success Rate: ' || ROUND((v_pass_count / v_test_count) * 100, 2) || '%');

END;

/
--------------------------------------------------------
--  DDL for Procedure SP_UPDATE_ORDER_STATUS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_UPDATE_ORDER_STATUS" (
    p_madon IN NUMBER,
    p_trangthai IN VARCHAR2,
    p_result OUT NUMBER,
    p_message OUT VARCHAR2
)
AS
    v_count NUMBER;
BEGIN
    -- Kiểm tra đơn hàng tồn tại
    SELECT COUNT(*) INTO v_count FROM ORDERS WHERE MADON = p_madon;

    IF v_count = 0 THEN
        p_result := 0;
        p_message := 'Đơn hàng không tồn tại';
        RETURN;
    END IF;

    -- Cập nhật trạng thái
    UPDATE ORDERS
    SET TRANGTHAI = p_trangthai
    WHERE MADON = p_madon;

    COMMIT;

    p_result := 1;
    p_message := 'Cập nhật trạng thái thành công';

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 0;
        p_message := 'Lỗi: ' || SQLERRM;
END;

/

  GRANT EXECUTE ON "CARSALE"."SP_UPDATE_ORDER_STATUS" TO "CARSALE_ADMIN_ROLE";
--------------------------------------------------------
--  DDL for Procedure SP_VIEW_FGA_LOGS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "CARSALE"."SP_VIEW_FGA_LOGS" (
    p_table_name IN VARCHAR2 DEFAULT NULL,
    p_days_back IN NUMBER DEFAULT 7
)
AS
BEGIN
    FOR rec IN (
        SELECT 
            TIMESTAMP,
            DB_USER,
            OS_USER,
            OBJECT_SCHEMA,
            OBJECT_NAME,
            SQL_TEXT,
            POLICY_NAME
        FROM DBA_FGA_AUDIT_TRAIL
        WHERE TIMESTAMP >= SYSDATE - p_days_back
        AND (p_table_name IS NULL OR OBJECT_NAME = p_table_name)
        ORDER BY TIMESTAMP DESC
    ) LOOP
        DBMS_OUTPUT.PUT_LINE('=================================');
        DBMS_OUTPUT.PUT_LINE('Time: ' || TO_CHAR(rec.TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'));
        DBMS_OUTPUT.PUT_LINE('User: ' || rec.DB_USER || ' (OS: ' || rec.OS_USER || ')');
        DBMS_OUTPUT.PUT_LINE('Object: ' || rec.OBJECT_SCHEMA || '.' || rec.OBJECT_NAME);
        DBMS_OUTPUT.PUT_LINE('Policy: ' || rec.POLICY_NAME);
        DBMS_OUTPUT.PUT_LINE('SQL: ' || SUBSTR(rec.SQL_TEXT, 1, 100));
    END LOOP;
END;

/
--------------------------------------------------------
--  DDL for Package PKG_SECURITY_CONTEXT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "CARSALE"."PKG_SECURITY_CONTEXT" AS
    PROCEDURE SET_USER_CONTEXT(p_makh IN NUMBER);
    PROCEDURE CLEAR_USER_CONTEXT;
END;

/
--------------------------------------------------------
--  DDL for Package Body PKG_SECURITY_CONTEXT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "CARSALE"."PKG_SECURITY_CONTEXT" AS
    
    PROCEDURE SET_USER_CONTEXT(p_makh IN NUMBER) IS
        v_max_read_level NUMBER;
        v_max_write_level NUMBER;
        v_compartments VARCHAR2(200);
    BEGIN
        -- Lấy thông tin security của user
        BEGIN
            SELECT MAX_READ_LEVEL, MAX_WRITE_LEVEL, COMPARTMENTS
            INTO v_max_read_level, v_max_write_level, v_compartments
            FROM USER_SECURITY_LABEL
            WHERE MAKH = p_makh;

            -- Set context
            DBMS_SESSION.SET_CONTEXT('CARSALE_SECURITY_CTX', 'MAKH', TO_CHAR(p_makh));
            DBMS_SESSION.SET_CONTEXT('CARSALE_SECURITY_CTX', 'MAX_READ_LEVEL', TO_CHAR(v_max_read_level));
            DBMS_SESSION.SET_CONTEXT('CARSALE_SECURITY_CTX', 'MAX_WRITE_LEVEL', TO_CHAR(v_max_write_level));
            DBMS_SESSION.SET_CONTEXT('CARSALE_SECURITY_CTX', 'COMPARTMENTS', v_compartments);

        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                -- User chưa có security label, set mặc định PUBLIC
                DBMS_SESSION.SET_CONTEXT('CARSALE_SECURITY_CTX', 'MAKH', TO_CHAR(p_makh));
                DBMS_SESSION.SET_CONTEXT('CARSALE_SECURITY_CTX', 'MAX_READ_LEVEL', '1000');
                DBMS_SESSION.SET_CONTEXT('CARSALE_SECURITY_CTX', 'MAX_WRITE_LEVEL', '1000');
                DBMS_SESSION.SET_CONTEXT('CARSALE_SECURITY_CTX', 'COMPARTMENTS', '');
        END;
    END;

    PROCEDURE CLEAR_USER_CONTEXT IS
    BEGIN
        DBMS_SESSION.CLEAR_CONTEXT('CARSALE_SECURITY_CTX');
    END;

END;

/
--------------------------------------------------------
--  DDL for Function FN_CHECK_USER_PERMISSION
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "CARSALE"."FN_CHECK_USER_PERMISSION" (
    p_makh IN NUMBER,
    p_action IN VARCHAR2,
    p_resource IN VARCHAR2
)
RETURN NUMBER
AS
    v_rolename VARCHAR2(30);
    v_has_permission NUMBER := 0;
BEGIN
    -- Lấy role của user
    SELECT ROLENAME INTO v_rolename
    FROM ACCOUNT_ROLE
    WHERE MAKH = p_makh;

    -- Kiểm tra quyền theo role và action
    IF v_rolename = 'ADMIN' THEN
        v_has_permission := 1; -- Admin có tất cả quyền
    ELSIF v_rolename = 'MANAGER' THEN
        IF p_action IN ('VIEW', 'CREATE', 'UPDATE') THEN
            v_has_permission := 1;
        END IF;
    ELSIF v_rolename = 'SALES' THEN
        IF p_action IN ('VIEW', 'CREATE') AND p_resource IN ('ORDER', 'CUSTOMER') THEN
            v_has_permission := 1;
        END IF;
    ELSIF v_rolename = 'CUSTOMER' THEN
        IF p_action = 'VIEW' OR (p_action = 'CREATE' AND p_resource = 'ORDER') THEN
            v_has_permission := 1;
        END IF;
    END IF;

    RETURN v_has_permission;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 0;
    WHEN OTHERS THEN
        RETURN 0;
END;

/
--------------------------------------------------------
--  DDL for Function FN_CUSTOMER_SECURITY_POLICY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "CARSALE"."FN_CUSTOMER_SECURITY_POLICY" (
    p_schema IN VARCHAR2,
    p_object IN VARCHAR2
)
RETURN VARCHAR2
AS
    v_predicate VARCHAR2(4000);
    v_user VARCHAR2(100);
BEGIN
    v_user := SYS_CONTEXT('USERENV', 'SESSION_USER');

    -- Admin thấy tất cả
    IF v_user = 'CARSALE' THEN
        RETURN '';
    END IF;

    -- User khác chỉ thấy dữ liệu của mình
    v_predicate := 'EMAIL = ''' || v_user || '''';

    RETURN v_predicate;
END;

/
--------------------------------------------------------
--  DDL for Function FN_MAC_READ_POLICY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "CARSALE"."FN_MAC_READ_POLICY" (
    p_schema IN VARCHAR2,
    p_object IN VARCHAR2
)
RETURN VARCHAR2
AS
    v_predicate VARCHAR2(4000);
    v_user_read_level NUMBER;
    v_user_compartments VARCHAR2(200);
    v_user VARCHAR2(100);
BEGIN
    v_user := SYS_CONTEXT('USERENV', 'SESSION_USER');

    -- Admin thấy tất cả
    IF v_user = 'CARSALE' THEN
        RETURN '';
    END IF;

    -- Lấy security level của user từ context
    BEGIN
        v_user_read_level := TO_NUMBER(SYS_CONTEXT('CARSALE_SECURITY_CTX', 'MAX_READ_LEVEL'));
        v_user_compartments := SYS_CONTEXT('CARSALE_SECURITY_CTX', 'COMPARTMENTS');
    EXCEPTION
        WHEN OTHERS THEN
            -- Nếu không có context, mặc định là PUBLIC
            v_user_read_level := 1000;
            v_user_compartments := '';
    END;

    -- Tạo predicate: chỉ đọc được data có level <= user's max read level
    v_predicate := '
        EXISTS (
            SELECT 1 FROM DATA_SECURITY_LABEL dsl
            WHERE dsl.TABLE_NAME = ''' || p_object || '''
            AND dsl.RECORD_ID = ' || p_object || '.MAKH
            AND dsl.SECURITY_LEVEL <= ' || v_user_read_level;

    -- Kiểm tra compartments nếu có
    IF v_user_compartments IS NOT NULL THEN
        v_predicate := v_predicate || '
            AND (dsl.COMPARTMENTS IS NULL 
                 OR INSTR(''' || v_user_compartments || ''', dsl.COMPARTMENTS) > 0)';
    END IF;

    v_predicate := v_predicate || '
        )';

    RETURN v_predicate;
END;

/
--------------------------------------------------------
--  DDL for Function FN_MAC_WRITE_POLICY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "CARSALE"."FN_MAC_WRITE_POLICY" (
    p_schema IN VARCHAR2,
    p_object IN VARCHAR2
)
RETURN VARCHAR2
AS
    v_predicate VARCHAR2(4000);
    v_user_write_level NUMBER;
    v_user_compartments VARCHAR2(200);
    v_user VARCHAR2(100);
BEGIN
    v_user := SYS_CONTEXT('USERENV', 'SESSION_USER');

    -- Admin có thể write tất cả
    IF v_user = 'CARSALE' THEN
        RETURN '';
    END IF;

    -- Lấy security level của user từ context
    BEGIN
        v_user_write_level := TO_NUMBER(SYS_CONTEXT('CARSALE_SECURITY_CTX', 'MAX_WRITE_LEVEL'));
        v_user_compartments := SYS_CONTEXT('CARSALE_SECURITY_CTX', 'COMPARTMENTS');
    EXCEPTION
        WHEN OTHERS THEN
            v_user_write_level := 1000;
            v_user_compartments := '';
    END;

    -- Tạo predicate: chỉ write được data có level <= user's max write level
    v_predicate := '
        EXISTS (
            SELECT 1 FROM DATA_SECURITY_LABEL dsl
            WHERE dsl.TABLE_NAME = ''' || p_object || '''
            AND dsl.RECORD_ID = ' || p_object || '.MAKH
            AND dsl.SECURITY_LEVEL <= ' || v_user_write_level;

    IF v_user_compartments IS NOT NULL THEN
        v_predicate := v_predicate || '
            AND (dsl.COMPARTMENTS IS NULL 
                 OR INSTR(''' || v_user_compartments || ''', dsl.COMPARTMENTS) > 0)';
    END IF;

    v_predicate := v_predicate || '
        )';

    RETURN v_predicate;
END;

/
--------------------------------------------------------
--  DDL for Function FN_ORDERS_SECURITY_POLICY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "CARSALE"."FN_ORDERS_SECURITY_POLICY" (
    p_schema IN VARCHAR2,
    p_object IN VARCHAR2
)
RETURN VARCHAR2
AS
    v_predicate VARCHAR2(4000);
    v_user VARCHAR2(100);
    v_makh NUMBER;
BEGIN
    v_user := SYS_CONTEXT('USERENV', 'SESSION_USER');

    -- Admin thấy tất cả
    IF v_user = 'CARSALE' THEN
        RETURN '';
    END IF;

    -- Lấy MAKH từ email
    BEGIN
        SELECT MAKH INTO v_makh FROM CUSTOMER WHERE EMAIL = v_user;
        v_predicate := 'MAKH = ' || v_makh;
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            v_predicate := '1=0'; -- Không cho phép truy cập
    END;

    RETURN v_predicate;
END;

/
--------------------------------------------------------
--  Constraints for Table FEEDBACK
--------------------------------------------------------

  ALTER TABLE "CARSALE"."FEEDBACK" ADD PRIMARY KEY ("MAFB")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ENCRYPTION_KEY
--------------------------------------------------------

  ALTER TABLE "CARSALE"."ENCRYPTION_KEY" ADD PRIMARY KEY ("KEYID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ORDER_DETAIL
--------------------------------------------------------

  ALTER TABLE "CARSALE"."ORDER_DETAIL" ADD CONSTRAINT "PK_ORDER_DETAIL" PRIMARY KEY ("MADON", "MAXE")
  USING INDEX "CARSALE"."PK_ORDER_DETAIL"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ORDERS
--------------------------------------------------------

  ALTER TABLE "CARSALE"."ORDERS" ADD PRIMARY KEY ("MADON")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table DATA_SECURITY_LABEL
--------------------------------------------------------

  ALTER TABLE "CARSALE"."DATA_SECURITY_LABEL" MODIFY ("TABLE_NAME" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."DATA_SECURITY_LABEL" MODIFY ("RECORD_ID" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."DATA_SECURITY_LABEL" MODIFY ("SECURITY_LEVEL" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."DATA_SECURITY_LABEL" ADD PRIMARY KEY ("DATA_LABEL_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table CUSTOMER
--------------------------------------------------------

  ALTER TABLE "CARSALE"."CUSTOMER" ADD UNIQUE ("EMAIL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
  ALTER TABLE "CARSALE"."CUSTOMER" ADD PRIMARY KEY ("MAKH")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table SECURITY_LEVEL
--------------------------------------------------------

  ALTER TABLE "CARSALE"."SECURITY_LEVEL" MODIFY ("LEVEL_NAME" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."SECURITY_LEVEL" MODIFY ("LEVEL_NUM" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."SECURITY_LEVEL" ADD PRIMARY KEY ("LEVEL_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table CAR
--------------------------------------------------------

  ALTER TABLE "CARSALE"."CAR" ADD PRIMARY KEY ("MAXE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table USER_SECURITY_LABEL
--------------------------------------------------------

  ALTER TABLE "CARSALE"."USER_SECURITY_LABEL" MODIFY ("MAKH" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."USER_SECURITY_LABEL" MODIFY ("MAX_READ_LEVEL" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."USER_SECURITY_LABEL" MODIFY ("MAX_WRITE_LEVEL" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."USER_SECURITY_LABEL" ADD PRIMARY KEY ("USER_LABEL_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table AUDIT_LOG
--------------------------------------------------------

  ALTER TABLE "CARSALE"."AUDIT_LOG" ADD PRIMARY KEY ("MALOG")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ACCOUNT_ROLE
--------------------------------------------------------

  ALTER TABLE "CARSALE"."ACCOUNT_ROLE" ADD PRIMARY KEY ("MATK")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table SECURITY_COMPARTMENT
--------------------------------------------------------

  ALTER TABLE "CARSALE"."SECURITY_COMPARTMENT" MODIFY ("COMP_NAME" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."SECURITY_COMPARTMENT" MODIFY ("COMP_CODE" NOT NULL ENABLE);
  ALTER TABLE "CARSALE"."SECURITY_COMPARTMENT" ADD PRIMARY KEY ("COMP_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CARSALE_TBS"  ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ACCOUNT_ROLE
--------------------------------------------------------

  ALTER TABLE "CARSALE"."ACCOUNT_ROLE" ADD CONSTRAINT "FK_ROLE_CUSTOMER" FOREIGN KEY ("MAKH")
	  REFERENCES "CARSALE"."CUSTOMER" ("MAKH") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table FEEDBACK
--------------------------------------------------------

  ALTER TABLE "CARSALE"."FEEDBACK" ADD CONSTRAINT "FK_FEEDBACK_CAR" FOREIGN KEY ("MAXE")
	  REFERENCES "CARSALE"."CAR" ("MAXE") ENABLE;
  ALTER TABLE "CARSALE"."FEEDBACK" ADD CONSTRAINT "FK_FEEDBACK_CUSTOMER" FOREIGN KEY ("MAKH")
	  REFERENCES "CARSALE"."CUSTOMER" ("MAKH") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ORDERS
--------------------------------------------------------

  ALTER TABLE "CARSALE"."ORDERS" ADD CONSTRAINT "FK_ORDER_CUSTOMER" FOREIGN KEY ("MAKH")
	  REFERENCES "CARSALE"."CUSTOMER" ("MAKH") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ORDER_DETAIL
--------------------------------------------------------

  ALTER TABLE "CARSALE"."ORDER_DETAIL" ADD CONSTRAINT "FK_ORDERDETAIL_CAR" FOREIGN KEY ("MAXE")
	  REFERENCES "CARSALE"."CAR" ("MAXE") ENABLE;
  ALTER TABLE "CARSALE"."ORDER_DETAIL" ADD CONSTRAINT "FK_ORDERDETAIL_ORDER" FOREIGN KEY ("MADON")
	  REFERENCES "CARSALE"."ORDERS" ("MADON") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table USER_SECURITY_LABEL
--------------------------------------------------------

  ALTER TABLE "CARSALE"."USER_SECURITY_LABEL" ADD CONSTRAINT "FK_USER_LABEL" FOREIGN KEY ("MAKH")
	  REFERENCES "CARSALE"."CUSTOMER" ("MAKH") ENABLE;
